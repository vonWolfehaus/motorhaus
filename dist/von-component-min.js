var von={};von.math_Vec2=function(){var t=function(t,i){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),this.x=t,this.y=i};return t.prototype.setLength=function(t){var i=this.getLength();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},t.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.getLengthSq=function(){return this.x*this.x+this.y*this.y},t.prototype.setAngle=function(t){var i=this.getAngle();return this.x=Math.cos(t)*i,this.y=Math.sin(t)*i,this},t.prototype.getAngle=function(){return Math.atan2(this.y,this.x)},t.prototype.rotateBy=function(t){var i=this.x,e=this.y,s=Math.cos(t),n=Math.sin(t);return this.x=i*s-e*n,this.y=i*n+e*s,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.divide=function(t){return 0===t.x||0===t.y?this:(this.x/=t.x,this.y/=t.y,this)},t.prototype.divideScalar=function(t){return 0===t?this:(this.x/=t,this.y/=t,this)},t.prototype.perp=function(){return this.y=-this.y,this},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.clamp=function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProd=function(t){return this.x*t.y-this.y*t.x},t.prototype.truncate=function(t){var i=this.getLength();return 0===i||t>i?this:(this.x/=i,this.y/=i,this.multiplyScalar(t),this)},t.prototype.angleTo=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.atan2(e,i)},t.prototype.distanceTo=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},t.prototype.distanceToSquared=function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},t.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},t.prototype.slerp=function(t,i){var e=this.dotProduct(t),s=this.x-t.x,n=this.y-t.y;-1>e&&(e=-1),e>1&&(e=1);var o=Math.acos(e)*i;s*=e,n*=e;var h=Math.sqrt(s*s+n*n);0!==h&&(s/=h,n/=h),this.multiplyScalar(Math.cos(o));var r=Math.sin(o);return this.x+=s*r,this.y+=n*r,this},t.prototype.nlerp=function(t,i){this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i;var e=this.getLength();return 0===e?this:(this.x/=e,this.y/=e,this)},t.prototype.normalize=function(){var t=this.getLength();return 0===t?this:(this.x/=t,this.y/=t,this)},t.prototype.reset=function(t,i){return t=t?t:0,i=i?i:0,this.x=t,this.y=i,this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y?!0:!1},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.draw=function(t,i,e,s){i=i?i:0,e=e?e:0,s=s?s:"rgb(0, 250, 0)",t.strokeStyle=s,t.beginPath(),t.moveTo(i,e),t.lineTo(this.x,this.y),t.stroke()},t.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},t.draw=function(t,i,e,s,n,o){n=n||0,o=o||0,t.strokeStyle=s?s:"rgb(250, 10, 10)",t.beginPath(),t.moveTo(i.x+n,i.y+o),t.lineTo(e.x+n,e.y+o),t.stroke()},window.Vec2=t,t}(),von.core_LinkedList=function(){var t=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0};window.LinkedListNode=t;var i=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueId=Date.now()+""+Math.floor(1e3*Math.random()),this.getNode=function(t){return this.objToNodeMap[t.uniqueId]},this.addNode=function(i){var e=new t;return e.obj=i,e.prev=null,e.next=null,e.free=!1,this.objToNodeMap[i.uniqueId]=e,e},this.add=function(t){var i=this.objToNodeMap[t.uniqueId];if(i){if(i.free===!1)return;i.obj=t,i.free=!1,i.next=null,i.prev=null}else i=this.addNode(t);if(this.first){if(null==this.last)throw new Error("Hmm, no last in the list -- that shouldn't happen here");this.last.next=i,i.prev=this.last,this.last=i,i.next=null}else this.first=i,this.last=i,i.next=null,i.prev=null;this.length++,this.showDebug&&this.dump("after add")},this.has=function(t){return!!this.objToNodeMap[t.uniqueId]},this.moveUp=function(t){this.dump("before move up");var i=this.getNode(t);if(!i)throw"Oops, trying to move an object that isn't in the list";if(null!=i.prev){var e=i.prev,s=e.prev;i==this.last&&(this.last=e);var n=i.next;s&&(s.next=i),i.next=e,i.prev=e.prev,e.next=n,e.prev=i,this.first==e&&(this.first=i)}},this.moveDown=function(t){var i=this.getNode(t);if(!i)throw"Oops, trying to move an object that isn't in the list";if(null!=i.next){var e=i.next;this.moveUp(e.obj),this.last==e&&(this.last=i)}},this.sort=function(t){for(var i,e,s=[],n=this.first;n;)s.push(n.object()),n=n.next();for(this.clear(),s.sort(t),e=s.length,i=0;e>i;i++)this.add(s[i])},this.remove=function(t){var i=this.getNode(t);return null==i||1==i.free?!1:(null!=i.prev&&(i.prev.next=i.next),null!=i.next&&(i.next.prev=i.prev),null==i.prev&&(this.first=i.next),null==i.next&&(this.last=i.prev),i.free=!0,i.prev=null,i.next=null,this.length--,!0)},this.shift=function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.pop=function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.clear=function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},this.dispose=function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},this.dump=function(t){console.log("===================="+t+"=====================");for(var i=this.first;null!=i;)console.log("{"+i.obj.toString()+"} previous="+(i.prev?i.prev.obj:"NULL")),i=i.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}};return window.LinkedList=i,i}(),von.core_Kai=function(){return{engine:null,view:null,renderHook:null,world:null,mouse:null,keys:null,pads:null,cache:null,load:null,debugCtx:null,components:[],width:window.innerWidth,height:window.innerHeight,ready:!1,inputBlocked:!0,registerComponents:function(t){var i,e,s=t.length,n={};for(i=0;s>i;i++)e=t[i],n[e.className]={accessor:e.accessor,proto:e,index:i};return n},addComponent:function(t,i,e,s){var n=i.accessor,o=null;return e=e||null,t.hasOwnProperty(n)?void console.warn("[Kai] "+n+" already exists on entity"):(o=new i.proto(t,e),this._registerComponent(i.index).add(o),void("undefined"==typeof s?t[n]=o:s.push(o)))},removeComponent:function(t,i){var e=i.accessor;t.hasOwnProperty(e)&&(this.components[i.index].remove(t[e]),t[e].dispose(),t[e]=null)},_registerComponent:function(t){return this.components[t]?this.components[t]:(this.components[t]=new LinkedList,this.components[t])}}}({},von.math_Vec2,von.core_LinkedList),von.core_Signal=function(){var t=function(t,i,e,s,n){"undefined"==typeof n&&(n=0),this.active=!0,this.params=null,this._listener=i,this._isOnce=e,this.context=s,this._signal=t,this.priority=n||0};t.prototype.execute=function(t){var i,e;return this.active&&this._listener&&(e=this.params?this.params.concat(t):t,i=this._listener.apply(this.context,e),this._isOnce&&this.detach()),i},t.prototype.detach=function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},t.prototype.isBound=function(){return!!this._signal&&!!this._listener},t.prototype.isOnce=function(){return this._isOnce},t.prototype.getListener=function(){return this._listener},t.prototype.getSignal=function(){return this._signal},t.prototype._destroy=function(){delete this._signal,delete this._listener,delete this.context},t.prototype.toString=function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"},window.SignalBinding=t;var i=function(){this._bindings=[],this._prevParams=null,this.memorize=!1,this._shouldPropagate=!0,this.active=!0};return i.prototype.validateListener=function(t,i){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",i))},i.prototype._registerListener=function(i,e,s,n){var o,h=this._indexOfListener(i,s);if(-1!==h){if(o=this._bindings[h],o.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,i,e,s,n),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},i.prototype._addBinding=function(t){var i=this._bindings.length;do--i;while(this._bindings[i]&&t.priority<=this._bindings[i].priority);this._bindings.splice(i+1,0,t)},i.prototype._indexOfListener=function(t,i){for(var e,s=this._bindings.length;s--;)if(e=this._bindings[s],e.getListener()===t&&e.context===i)return s;return-1},i.prototype.has=function(t,i){return"undefined"==typeof i&&(i=null),-1!==this._indexOfListener(t,i)},i.prototype.add=function(t,i,e){return"undefined"==typeof i&&(i=null),"undefined"==typeof e&&(e=0),this.validateListener(t,"add"),this._registerListener(t,!1,i,e)},i.prototype.addOnce=function(t,i,e){return"undefined"==typeof i&&(i=null),"undefined"==typeof e&&(e=0),this.validateListener(t,"addOnce"),this._registerListener(t,!0,i,e)},i.prototype.remove=function(t,i){"undefined"==typeof i&&(i=null),this.validateListener(t,"remove");var e=this._indexOfListener(t,i);return-1!==e&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)),t},i.prototype.removeAll=function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},i.prototype.getNumListeners=function(){return this._bindings.length},i.prototype.halt=function(){this._shouldPropagate=!1},i.prototype.dispatch=function(){for(var t=[],i=0;i<arguments.length-0;i++)t[i]=arguments[i+0];if(this.active){var e,s=this._bindings.length;if(this.memorize&&(this._prevParams=t),s){e=this._bindings.slice(0),this._shouldPropagate=!0;do s--;while(e[s]&&this._shouldPropagate&&e[s].execute(t)!==!1)}}},i.prototype.forget=function(){this._prevParams=null},i.prototype.dispose=function(){this.removeAll(),delete this._bindings,delete this._prevParams},i.prototype.toString=function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"},i.VERSION="1.0.0",window.Signal=i,i}(),von.core_CommTower=function(){return{requestState:new Signal,pause:new Signal,resume:new Signal}}(von.core_Signal),von.core_StateManager=function(t,i,e){var s=i,n=e,o=function(){this.states={},this.current=null,this.ready=!1,this.queue=[]};return o.prototype={init:function(){n.requestState.add(this.switchState,this),s.load.onLoadComplete.add(this.loadComplete,this),this.next()},add:function(t,i){var e;return"object"==typeof i?e=i:"function"==typeof i&&(e=new i),this.checkState(t,e)!==!1?(this.states[t]=e,e):void 0},remove:function(t){delete this.states[t]},update:function(){var t=this.states[this.current];t.update()},draw:function(){var t=this.states[this.current];t.draw()},switchState:function(t,i){return this.states[t]?(this.ready=!1,this.queue.push(t),"undefined"==typeof i&&(i=!1),void this.next(i)):void console.warn("[StateManager.switchState] "+t+" not found")},next:function(t){var i;0!==this.queue.length&&s.ready!==!1&&(t&&s.cache.dispose(),this.current&&(i=this.states[this.current],i.dispose()),this.current=this.queue.shift(),i=this.states[this.current],s.load.reset(),i.preload(),s.inputBlocked=!0,s.load.start())},checkState:function(t,i){var e=!1;return this.states[t]?(console.error("[StateManager.checkState] Duplicate key: "+t),!1):i?(i.preload&&i.create&&i.update&&i.draw&&i.dispose&&(e=!0),e?!0:(console.error('[StateManager.checkState] Invalid State "'+t+'" given. Must contain all required functions.'),!1)):(console.error("[StateManager.checkState] No state found with the key: "+t),!1)},loadComplete:function(){var t=this.states[this.current];t.create(),s.inputBlocked=!1,this.ready=!0},dispose:function(){this.states=null,this.queue=null}},o}({},von.core_Kai,von.core_CommTower),von.utils_RequestAnimationFrame=function(){var t=function(t){var i=["ms","moz","webkit","o"];this.game=t,this.isRunning=!1;for(var e=0;e<i.length&&!window.requestAnimationFrame;e++)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null};return t.prototype={start:function(){this.isRunning=!0;var t=this;window.requestAnimationFrame?(this._isSetTimeOut=!1,this._onLoop=function(i){return t.updateRAF(i)},this._timeOutID=window.requestAnimationFrame(this._onLoop)):(this._isSetTimeOut=!0,this._onLoop=function(){return t.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0))},updateRAF:function(t){this.game.update(t),this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},t}(),von.utils_Loader=function(t,i){var e=i,s=function(){this.baseURL="",this.crossOrigin="",this.isLoading=!1,this.progress=0,this.onFileComplete=new Signal,this.onFileError=new Signal,this.onLoadStart=new Signal,this.onLoadComplete=new Signal,this._fileList=[],this._fileIndex=0,this._xhr=new XMLHttpRequest};return s.prototype={image:function(t,i,e){return"undefined"==typeof e&&(e=!1),e?this._replaceInFileList("image",t,i):this._addToFileList("image",t,i),this},spritesheet:function(t,i,e,s,n){return"undefined"==typeof n&&(n=-1),this._addToFileList("spritesheet",t,i,{frameWidth:e,frameHeight:s,frameMax:n}),this},text:function(t,i,e){return"undefined"==typeof e&&(e=!1),e?this._replaceInFileList("text",t,i):this._addToFileList("text",t,i),this},audio:function(t,i,e){return"undefined"==typeof e&&(e=!0),this.addToFileList("audio",t,i,{buffer:null,autoDecode:e}),this},removeFile:function(t,i){var e=this.getAsset(t,i);e!==!1&&this._fileList.splice(e.index,1)},removeAll:function(){this._fileList.length=0},start:function(){this.isLoading||(this.progress=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this._fileList.length),this._fileList.length>0?(this._fileIndex=0,this._progressChunk=100/this._fileList.length,this._loadFile()):(this.progress=100,this.hasLoaded=!0,this.onLoadComplete.dispatch()))},reset:function(){this.preloadSprite=null,this.isLoading=!1,this._fileList.length=0,this._fileIndex=0},getAsset:function(t,i){if(this._fileList.length>0)for(var e=0;e<this._fileList.length;e++)if(this._fileList[e].type===t&&this._fileList[e].key===i)return{index:e,file:this._fileList[e]};return!1},totalLoadedFiles:function(){for(var t=0,i=0;i<this._fileList.length;i++)this._fileList[i].loaded&&t++;return t},totalQueuedFiles:function(){var t,i=0;for(t=0;t<this._fileList.length;t++)this._fileList[t].loaded===!1&&i++;return i},checkKeyExists:function(t,i){if(this._fileList.length>0)for(var e=0;e<this._fileList.length;e++)if(this._fileList[e].type===t&&this._fileList[e].key===i)return!0;return!1},_addToFileList:function(t,i,e,s){var n={type:t,key:i,url:e,data:null,error:!1,loaded:!1};if("undefined"!=typeof s)for(var o in s)n[o]=s[o];this.checkKeyExists(t,i)?console.warn('[Loader] "'+i+'" already exists, use overwrite if you want to replace it in cache'):this._fileList.push(n)},_replaceInFileList:function(t,i,e,s){var n={type:t,key:i,url:e,data:null,error:!1,loaded:!1};if("undefined"!=typeof s)for(var o in s)n[o]=s[o];this.checkKeyExists(t,i)===!1&&this._fileList.push(n)},_loadFile:function(){if(!this._fileList[this._fileIndex])return void console.warn("Phaser.Loader _loadFile invalid index "+this._fileIndex);var t=this._fileList[this._fileIndex],i=this;switch(t.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":case"tileset":t.data=new Image,t.data.name=t.key,t.data.onload=function(){return i._fileComplete(i._fileIndex)},t.data.onerror=function(){return i._fileError(i._fileIndex)},t.data.crossOrigin=this.crossOrigin,t.data.src=this.baseURL+t.url;break;case"audio":break;case"text":this._xhr.open("GET",this.baseURL+t.url,!0),this._xhr.responseType="text",this._xhr.onload=function(){return i._fileComplete(i._fileIndex)},this._xhr.onerror=function(){return i._fileError(i._fileIndex)},this._xhr.send()}},_nextFile:function(t,i){this.progress=Math.round(this.progress+this._progressChunk),this.progress>100&&(this.progress=100),null!==this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.crop.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.crop.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.crop=this.preloadSprite.crop),this.onFileComplete.dispatch(this.progress,this._fileList[t].key,i,this.totalLoadedFiles(),this._fileList.length),this.totalQueuedFiles()>0?(this._fileIndex++,this._loadFile()):(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())},_getAudioURL:function(){return null},_fileError:function(t){this._fileList[t].loaded=!0,this._fileList[t].error=!0,this.on_fileError.dispatch(this._fileList[t].key,this._fileList[t]),console.warn("Phaser.Loader error loading file: "+this._fileList[t].key+" from URL "+this._fileList[t].url),this._nextFile(t,!1)},_fileComplete:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader _fileComplete invalid index "+t);var i=this._fileList[t];i.loaded=!0;var s=!0;switch(i.type){case"image":e.cache.addImage(i.key,i.url,i.data);break;case"spritesheet":e.cache.addSpriteSheet(i.key,i.url,i.data,i.frameWidth,i.frameHeight,i.frameMax);break;case"tileset":e.cache.addTileset(i.key,i.url,i.data,i.tileWidth,i.tileHeight,i.tileMax,i.tileMargin,i.tileSpacing);break;case"audio":break;case"text":i.data=this._xhr.responseText,e.cache.addText(i.key,i.url,i.data);break;case"script":i.data=document.createElement("script"),i.data.language="javascript",i.data.type="text/javascript",i.data.defer=!1,i.data.text=this._xhr.responseText,document.head.appendChild(i.data)}s&&this._nextFile(t,!0)},_jsonLoadComplete:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader _jsonLoadComplete invalid index "+t);var i=this._fileList[t],s=JSON.parse(this._xhr.responseText);i.loaded=!0,"tilemap"===i.type?e.cache.addTilemap(i.key,i.url,s,i.format):e.cache.addTextureAtlas(i.key,i.url,i.data,s,i.format),this._nextFile(t,!0)}},s}({},von.core_Kai),von.utils_Cache=function(){var t=function(){this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._tilemaps={},this._tilesets={},this._bitmapDatas={},this.addDefaultImage(),this.addMissingImage(),this.onSoundUnlock=new Signal};return t.prototype={addCanvas:function(t,i,e){this._canvases[t]={canvas:i,context:e}},addBitmapData:function(t,i){return this._bitmapDatas[t]=i,i},addSpriteSheet:function(){},addTileset:function(){},addTilemap:function(){},addTextureAtlas:function(){},addBitmapFont:function(){},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",this._images.__default={url:null,data:t,spriteSheet:!1}},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",this._images.__missing={url:null,data:t,spriteSheet:!1}},addText:function(t,i,e){this._text[t]={url:i,data:e}},addImage:function(t,i,e){this._images[t]={url:i,data:e,spriteSheet:!1}},addSound:function(t,i,e,s,n){s=s||!0,n=n||!1;var o=!1;n&&(o=!0),this._sounds[t]={url:i,data:e,isDecoding:!1,decoded:o,webAudio:s,audioTag:n}},reloadSound:function(t){var i=this;this._sounds[t]&&(this._sounds[t].data.src=this._sounds[t].url,this._sounds[t].data.addEventListener("canplaythrough",function(){return i.reloadSoundComplete(t)},!1),this._sounds[t].data.load())},reloadSoundComplete:function(t){this._sounds[t]&&(this._sounds[t].locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,i,e){this._sounds[t]&&(this._sounds[t][i]=e)},decodedSound:function(t,i){this._sounds[t].data=i,this._sounds[t].decoded=!0,this._sounds[t].isDecoding=!1},getCanvas:function(t){return this._canvases[t]?this._canvases[t].canvas:null},getBitmapData:function(t){return this._bitmapDatas[t]?this._bitmapDatas[t]:null},checkImageKey:function(t){return this._images[t]?!0:!1},getImage:function(t){return this._images[t]?this._images[t].data:null},getTilesetImage:function(t){return this._tilesets[t]?this._tilesets[t].data:null},getTileset:function(t){return this._tilesets[t]?this._tilesets[t].tileData:null},getTilemapData:function(t){return this._tilemaps[t]?this._tilemaps[t]:null},getFrameData:function(t){return this._images[t]&&this._images[t].frameData?this._images[t].frameData:null},getFrameByIndex:function(t,i){return this._images[t]&&this._images[t].frameData?this._images[t].frameData.getFrame(i):null},getFrameByName:function(t,i){return this._images[t]&&this._images[t].frameData?this._images[t].frameData.getFrameByName(i):null},getFrame:function(t){return this._images[t]&&this._images[t].spriteSheet===!1?this._images[t].frame:null},getTextureFrame:function(t){return this._textures[t]?this._textures[t].frame:null},getTexture:function(t){return this._textures[t]?this._textures[t]:null},getSound:function(t){return this._sounds[t]?this._sounds[t]:null},getSoundData:function(t){return this._sounds[t]?this._sounds[t].data:null},isSoundDecoded:function(t){return this._sounds[t]?this._sounds[t].decoded:void 0},isSoundReady:function(t){return this._sounds[t]&&this._sounds[t].decoded&&this.game.sound.touchLocked===!1},isSpriteSheet:function(t){return this._images[t]?this._images[t].spriteSheet:!1},getText:function(t){return this._text[t]?this._text[t].data:null},getKeys:function(t){var i,e=[];for(i in t)"__default"!==i&&e.push(i);return e},getImageKeys:function(){return this.getKeys(this._images)},getSoundKeys:function(){return this.getKeys(this._sounds)},getTextKeys:function(){return this.getKeys(this._text)},removeCanvas:function(t){delete this._canvases[t]},removeImage:function(t){delete this._images[t]},removeSound:function(t){delete this._sounds[t]},removeText:function(t){delete this._text[t]},dispose:function(){var t;for(t in this._canvases)delete this._canvases[t.key];for(t in this._images)delete this._images[t.key];for(t in this._sounds)delete this._sounds[t.key];for(t in this._text)delete this._text[t.key]}},t}(),von.components_input_MouseController=function(t){return function(){function i(i){t.inputBlocked||(o.position.x=i.pageX,o.position.y=i.pageY,o.down=!0,o.shift=!!i.shiftKey,o.ctrl=!!i.ctrlKey,o.onDown.dispatch(o.position))}function e(i){o.down&&!t.inputBlocked&&(o.position.x=i.pageX,o.position.y=i.pageY,o.down=!1,o.shift=!!i.shiftKey,o.ctrl=!!i.ctrlKey,o.onUp.dispatch(o.position))}function s(t){t.preventDefault(),o.position.x=t.pageX,o.position.y=t.pageY,o.shift=!!t.shiftKey,o.ctrl=!!t.ctrlKey}function n(t){return t.preventDefault(),!1}this.position=new Vec2,this.onDown=new Signal,this.onUp=new Signal,this.down=!1,this.shift=!1,this.ctrl=!1;var o=this;!function(){document.addEventListener("mousedown",i,!1),document.addEventListener("mouseup",e,!1),document.addEventListener("mouseout",e,!1),document.addEventListener("mousemove",s,!1),document.addEventListener("contextmenu",n,!1)}()}}(von.core_Kai),von.components_input_KeyboardController=function(t){var i=function(){this.key=-1,this.onDown=new Signal,this.onUp=new Signal,this.shift=!1,this.ctrl=!1,this._keys={},this._prev=null,document.addEventListener("keydown",this._processDown.bind(this),!1),document.addEventListener("keyup",this._processUp.bind(this),!1)};return i.prototype={_processDown:function(i){var e=this._keys[i.keyCode];t.inputBlocked||this.key===this._prev||(this.shift=!!i.shiftKey,this.ctrl=!!i.ctrlKey,this.key=i.keyCode,e&&e.isDown?this._keys[i.keyCode].duration=performance.now()-e.timeDown:e?(this._keys[i.keyCode].isDown=!0,this._keys[i.keyCode].timeDown=performance.now(),this._keys[i.keyCode].duration=0):this._keys[i.keyCode]={isDown:!0,timeDown:performance.now(),timeUp:0,duration:0},this.onDown.dispatch(this.key),this._prev=this.key)},_processUp:function(i){t.inputBlocked||(this.key=-1,this.shift=!1,this.ctrl=!1,this._keys[i.keyCode]?(this._keys[i.keyCode].isDown=!1,this._keys[i.keyCode].timeUp=performance.now()):this._keys[i.keyCode]={isDown:!1,timeDown:performance.now(),timeUp:performance.now(),duration:0},this.onUp.dispatch(i.keyCode,this._keys[i.keyCode].timeUp-this._keys[i.keyCode].timeDown))},activate:function(){for(var t in this._keys)this._keys[t].isDown=!1},justPressed:function(t,i){return"undefined"==typeof i&&(i=100),this._keys[t]&&this._keys[t].isDown&&this._keys[t].duration<i?!0:!1},justReleased:function(t,i){return"undefined"==typeof i&&(i=100),this._keys[t]&&this._keys[t].isDown===!1&&performance.now()-this._keys[t].timeUp<i?!0:!1},isDown:function(t){return this._keys[t]?this._keys[t].isDown:!1},A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,UNDERSCORE:189,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},i}(von.core_Kai),von.core_Engine=function(t,i,e,s,n,o,h,r,a){var l=i,u=e,c=s,d=n,p=o,f=h,_=r,y=a,m=function(){this.state=new c,this.raf=new d(this),this._paused=!1;var t=this;this._onInit=function(){return t.init()},"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(this._onInit,0):(document.addEventListener("DOMContentLoaded",this._onInit,!1),window.addEventListener("load",this._onInit,!1))};return m.prototype={constructor:m,init:function(){if(!l.ready){var t=this;if(!document.body)return void window.setTimeout(this._onInit,20);console.log("[Engine.init] Ready"),document.removeEventListener("DOMContentLoaded",this._onInit),window.removeEventListener("load",this._onInit),window.addEventListener("focus",function(){t._paused=!1,u.resume.dispatch()},!1),window.addEventListener("blur",function(){t._paused=!0,u.pause.dispatch()},!1),l.engine=this,l.mouse=new _,l.keys=new y,l.cache=new f,l.load=new p,l.ready=!0,this.state.init(),l.inputBlocked=!1,this.raf.start()}},start:function(t){l.ready||this.state.switchState(t)},update:function(){var t,i,e,s=l.components,n=s.length;if(this._paused)l.renderHook&&l.renderHook();else{if(l.debugCtx&&l.debugCtx.clearRect(0,0,l.width,l.height),this.state.ready){for(t=0;n>t;t++)if(s[t])for(i=s[t].first;i;)e=i.obj,e.active&&e.update(),i=i.next;this.state.update()}l.renderHook&&l.renderHook()}},dispose:function(){}},m}({},von.core_Kai,von.core_CommTower,von.core_StateManager,von.utils_RequestAnimationFrame,von.utils_Loader,von.utils_Cache,von.components_input_MouseController,von.components_input_KeyboardController),von.utils_Tools={isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!hasOwn.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}return!0},merge:function(){var t,i,e,s,n,o,h=arguments[0]||{},r=1,a=arguments.length,l=!1;for("boolean"==typeof h&&(l=h,h=arguments[1]||{},r=2);a>r;r++)if(null!=(t=arguments[r]))for(i in t)e=h[i],s=t[i],h!==s&&(l&&s&&(this.isPlainObject(s)||(n=Array.isArray(s)))?(n?(n=!1,o=e&&Array.isArray(e)?e:[]):o=e&&this.isPlainObject(e)?e:{},h[i]=this.extend(l,o,s)):void 0!==s&&(h[i]=s));return h}},von.core_Base=function(){var t=function(){this.uniqueId=Math.random().toString(36).slice(2)+Date.now(),this.active=!1};return t}(),von.components_graphics_OCANSquare=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.width=50,this.height=50,o.merge(this,i),this.entity=t,this._display=n.view.display.rectangle({x:t.position.x,y:t.position.y,origin:{x:"center",y:"center"},width:this.width,height:this.height,fill:"#079",join:"round"}),this.position=t.position,n.view.addChild(this._display)};return h.accessor="view",h.className="OCAN_SQUARE",h.priority=10,h.prototype={constructor:h,activate:function(){},update:function(){this._display.x=this.position.x,this._display.y=this.position.y},dispose:function(){n.view.removeChild(this._display),this.entity=null,this.position=null,this._display=null}},h}({},von.core_Kai,von.utils_Tools,von.core_Base),von.entities_World=function(t,i){var e=i;return{width:1,height:1,depth:1,scale:1,gravity:8,friction:.98,elapsed:.01666,broadphase:null,map:null,camera:null,set:function(t){e.merge(this,t)}}}({},von.utils_Tools),von.components_physics_AABB2=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.width=50,this.height=50,this.min=new Vec2,this.max=new Vec2,this.mass=100,this.invmass=0,this.restitution=.6,this.solid=!0,n.merge(this,i),this.entity=t,this._halfWidth=this.width/2,this._halfHeight=this.height/2,this.position=t.position,this.velocity=t.velocity,this.min.x=this.position.x-this._halfWidth,this.min.y=this.position.y-this._halfHeight,this.max.x=this.position.x+this._halfWidth,this.max.y=this.position.y+this._halfHeight,this.setMass(this.mass)};return h.accessor="body",h.className="BODY_AABB2",h.priority=1,h.prototype={constructor:h,setMass:function(t){this.mass=t,this.invmass=0>=t?0:1/t},activate:function(){this.setMass(this.mass)},update:function(){this.velocity.y+=o.gravity*o.elapsed,this.position.x+=this.velocity.x*o.elapsed,this.position.y+=this.velocity.y*o.elapsed,this.position.x<this._halfWidth?(this.position.x=this._halfWidth,this.velocity.x=-this.velocity.x*this.restitution):this.position.x+this._halfWidth>o.width&&(this.position.x=o.width-this._halfWidth,this.velocity.x=-this.velocity.x*this.restitution),this.position.y<this._halfWidth?(this.position.y=this._halfWidth,this.velocity.y=-this.velocity.y*this.restitution):this.position.y+this._halfHeight>o.height&&(this.position.y=o.height-this._halfHeight,this.velocity.y=-this.velocity.y*this.restitution),this.min.x=this.position.x-this._halfWidth,this.min.y=this.position.y-this._halfHeight,this.max.x=this.position.x+this._halfWidth,this.max.y=this.position.y+this._halfHeight
},dispose:function(){this.entity=null,this.position=null,this.velocity=null}},h}({},von.utils_Tools,von.entities_World,von.core_Base),von.components_graphics_OCANCircle=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.radius=25,o.merge(this,i),this.entity=t,this._display=n.view.display.arc({x:t.position.x,y:t.position.y,start:0,end:360,radius:this.radius,fill:"#079"}),this.position=t.position,n.view.addChild(this._display)};return h.accessor="view",h.className="OCAN_CIRCLE",h.priority=10,h.prototype={constructor:h,activate:function(){this.active=!0},update:function(){this._display.x=this.position.x,this._display.y=this.position.y},dispose:function(){n.view.removeChild(this._display),this.entity=null,this.position=null,this._display=null}},h}({},von.core_Kai,von.utils_Tools,von.core_Base),von.physics_PhysicsConstants=function(){return{BOUNDARY_WRAP:"wrap",BOUNDARY_BOUNCE:"bounce",BOUNDARY_DISABLE:"disable"}}({}),von.components_physics_RadialCollider2=function(t,i,e,s,n){var o=i,h=e,r=s,a=function(t,i){n.call(this),this.radius=25,this.mass=100,this.invmass=0,this.restitution=.8,this.maxSpeed=200,this.solid=!0,this.hasAccel=!1,this.hasFriction=!1,this.autoAdd=!0,this.collisionId=this.uniqueId,this.boundaryBehavior=r.BOUNDARY_BOUNCE,o.merge(this,i),this.onCollision=new Signal,this.entity=t,this.position=t.position,this.velocity=t.velocity,this.hasAccel&&(this.accel=t.accel),this.setMass(this.mass)};return a.accessor="body",a.className="BODY_RADIAL_COLLIDER2",a.priority=1,a.prototype={constructor:a,setMass:function(t){this.mass=t,this.invmass=0>=t?0:1/t},activate:function(){this.solid=!0,this.active=!0,this.autoAdd&&h.broadphase.add(this)},disable:function(){this.solid=!1,this.active=!1,this.autoAdd&&h.broadphase.remove(this)},update:function(){switch(this.velocity.y+=h.gravity*h.elapsed,this.hasAccel&&(this.velocity.x+=this.accel.x,this.velocity.y+=this.accel.y,this.velocity.truncate(this.maxSpeed)),this.hasFriction&&(this.velocity.x*=h.friction,this.velocity.y*=h.friction),this.position.x+=this.velocity.x*h.elapsed,this.position.y+=this.velocity.y*h.elapsed,this.boundaryBehavior){case r.BOUNDARY_DISABLE:(this.position.x<this.radius||this.position.x+this.radius>h.width||this.position.y<this.radius||this.position.y+this.radius>h.height)&&this.onCollision.dispatch(null);break;case r.BOUNDARY_BOUNCE:this.position.x<this.radius?(this.position.x=this.radius,this.velocity.x=-this.velocity.x*this.restitution):this.position.x+this.radius>h.width&&(this.position.x=h.width-this.radius,this.velocity.x=-this.velocity.x*this.restitution),this.position.y<this.radius?(this.position.y=this.radius,this.velocity.y=-this.velocity.y*this.restitution):this.position.y+this.radius>h.height&&(this.position.y=h.height-this.radius,this.velocity.y=-this.velocity.y*this.restitution);break;case r.BOUNDARY_WRAP:this.position.x<this.radius?this.position.x+=h.width+this.radius:this.position.x+this.radius>h.width&&(this.position.x-=h.width-this.radius),this.position.y<this.radius?this.position.y+=h.height+this.radius:this.position.y+this.radius>h.height&&(this.position.y-=h.height-this.radius)}},dispose:function(){this.onCollision.dispose(),this.entity=null,this.position=null,this.velocity=null,this.onCollision=null}},a}({},von.utils_Tools,von.entities_World,von.physics_PhysicsConstants,von.core_Base),von.components_graphics_THREECube=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.size=50,this.dynamic=!1,this.color=16693068,this.textureUrl="img/square-outline-textured.png",o.merge(this,i),this.entity=t,this._display=null;var e=new THREE.CubeGeometry(this.size,this.size,this.size),h=new THREE.MeshLambertMaterial({color:this.color,ambient:this.color,shading:THREE.FlatShading,map:this.dynamic?null:THREE.ImageUtils.loadTexture(this.textureUrl)});this._display=new THREE.Mesh(e,h),this.dynamic||(this._display.matrixAutoUpdate=!1,this._display.position.copy(t.position),this._display.updateMatrix()),this.position=t.position,n.view.add(this._display)};return h.accessor="view",h.className="THREE_CUBE",h.priority=10,h.prototype={constructor:h,activate:function(){},update:function(){this._display.position.x=this.position.x,this._display.position.y=this.position.y,this._display.position.z=this.position.z},dispose:function(){n.view.remove(this._display),this.entity=null,this.position=null,this._display=null}},h}({},von.core_Kai,von.utils_Tools,von.core_Base),von.components_physics_AABB3=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.width=50,this.height=50,this.depth=50,this.min=new THREE.Vector3,this.max=new THREE.Vector3,this.mass=100,this.invmass=0,this.restitution=.6,n.merge(this,i),this.entity=t,this._halfWidth=this.width/2,this._halfHeight=this.height/2,this._halfDepth=this.depth/2,this.position=t.position,this.velocity=t.velocity,this.min.x=this.position.x-this._halfWidth,this.min.y=this.position.y-this._halfHeight,this.min.z=this.position.z-this._halfDepth,this.max.x=this.position.x+this._halfWidth,this.max.y=this.position.y+this._halfHeight,this.max.z=this.position.z+this._halfDepth,this.setMass(this.mass)};return h.accessor="body",h.className="BODY_AABB3",h.priority=1,h.prototype={constructor:h,setMass:function(t){this.mass=t,this.invmass=0>=t?0:1/t},activate:function(){this.setMass(this.mass)},update:function(){this.velocity.y+=o.gravity*o.elapsed,this.position.x+=this.velocity.x*o.elapsed,this.position.y+=this.velocity.y*o.elapsed,this.position.z+=this.velocity.z*o.elapsed,this.position.x<0?(this.position.x=0,this.velocity.x=-this.velocity.x*this.restitution):this.position.x+this._halfWidth>o.width&&(this.position.x=o.width-this._halfWidth,this.velocity.x=-this.velocity.x*this.restitution),this.position.y<0?(this.position.y=0,this.velocity.y=-this.velocity.y*this.restitution):this.position.y+this._halfHeight>o.height&&(this.position.y=o.height-this._halfHeight,this.velocity.y=-this.velocity.y*this.restitution),this.min.x=this.position.x-this._halfWidth,this.min.y=this.position.y-this._halfHeight,this.min.z=this.position.z-this._halfDepth,this.max.x=this.position.x+this._halfWidth,this.max.y=this.position.y+this._halfHeight,this.max.z=this.position.z+this._halfDepth},dispose:function(){this.entity=null,this.position=null,this.velocity=null}},h}({},von.utils_Tools,von.entities_World,von.core_Base),von.physics_Manifold=function(){this.a=null,this.b=null,this.penetration=0,this.normal=new Vec2},von.physics_Physics2=function(t,i){var e=i;return{_scratch:new Vec2,_normal:new Vec2,_impulse:new Vec2,_manifold:new e,resolve:function(t,i,e){this._scratch.reset(i.velocity.x-t.velocity.x,i.velocity.y-t.velocity.y);var s=this._scratch.dotProduct(e.normal);if(!(s>0)){var n=Math.min(t.restitution,i.restitution),o=-(1+n)*s;o/=t.invmass+i.invmass,this._impulse.reset(e.normal.x*o,e.normal.y*o),t.velocity.x-=t.invmass*this._impulse.x,t.velocity.y-=t.invmass*this._impulse.y,i.velocity.x+=i.invmass*this._impulse.x,i.velocity.y+=i.invmass*this._impulse.y}},testAABBvsAABB:function(t,i){return t.min.x>i.max.x?!1:t.min.y>i.max.y?!1:t.max.x<i.min.x?!1:t.max.y<i.min.y?!1:!0},separateAABBvsAABB:function(t,i){if(t.max.x<i.min.x||t.min.x>i.max.x)return null;if(t.max.y<i.min.y||t.min.y>i.max.y)return null;this._normal.reset(i.position.x-t.position.x,i.position.y-t.position.y);var e=(t.max.x-t.min.x)/2,s=(i.max.x-i.min.x)/2,n=e+s-Math.abs(this._normal.x);if(n>0){e=(t.max.y-t.min.y)/2,s=(i.max.y-i.min.y)/2;var o=e+s-Math.abs(this._normal.y);if(o>0){o>n?(this._normal.x<0?this._manifold.normal.reset(-1,0):this._manifold.normal.reset(1,0),this._manifold.penetration=n):(this._normal.y<0?this._manifold.normal.reset(0,-1):this._manifold.normal.reset(0,1),this._manifold.penetration=o);var h=this._manifold.penetration*this._manifold.normal.x,r=this._manifold.penetration*this._manifold.normal.y,a=t.invmass+i.invmass;return t.position.x-=h*(t.invmass/a),t.position.y-=r*(t.invmass/a),i.position.x+=h*(i.invmass/a),i.position.y+=r*(i.invmass/a),this._manifold}}return null},testCircleVsCircle:function(t,i){var e=i.position.x-t.position.x,s=i.position.y-t.position.y,n=e*e+s*s,o=t.radius+i.radius;return o*o>n?!0:!1},separateCircleVsCircle:function(t,i){var e,s,n,o,h=i.position.x-t.position.x,r=i.position.y-t.position.y,a=h*h+r*r,l=t.radius+i.radius,u=l*l;return u>a?(a=Math.sqrt(h*h+r*r),0===a?(a=t.radius+i.radius-1,h=r=l,this._manifold.penetration=t.radius,this._manifold.normal.reset(1,0)):(this._manifold.penetration=u-a,this._manifold.normal.reset(h,r).normalize()),s=(l-a)/a,n=h*s,o=r*s,e=t.invmass+i.invmass,t.position.x-=n*(t.invmass/e),t.position.y-=o*(t.invmass/e),i.position.x+=n*(i.invmass/e),i.position.y+=o*(i.invmass/e),this._manifold):null}}}({},von.physics_Manifold),von.components_physics_CollisionGridScanner=function(t,i,e,s,n){var o=i,h=e,r=s,a=function(t,i){n.call(this),this.scanRadius=1,o.merge(this,i),this.onCollision=new Signal,this.entity=t,this._body=t.body,this._nearby=new LinkedList,this._grid=h.broadphase};return a.accessor="collisionScanner",a.className="COLLISION_SCANNER_RADIAL",a.priority=5,a.prototype={constructor:a,activate:function(){this.active=!0},disable:function(){this.active=!1},update:function(){var t,i;for(this._grid.getNeighbors(this._body,this.scanRadius,this._nearby),t=this._nearby.first;t;){if(i=t.obj,r.testCircleVsCircle(i,this._body)){this.onCollision.dispatch(i);break}t=t.next}},dispose:function(){this.onCollision.dispose(),this.entity=null,this.position=null,this.onCollision=null}},a}({},von.utils_Tools,von.entities_World,von.physics_Physics2,von.core_Base),von.components_Health=function(t,i,e){var s=i,n=function(t,i){e.call(this),this.max=100,this.overage=0,this.alive=!1,this.active=!1,s.merge(this,i),this.onDeath=new Signal,this.onDamage=new Signal,this.onHeal=new Signal,this.onFull=new Signal,this.onActivate=new Signal,this.entity=t,this._meter=0};return n.accessor="health",n.className="HEALTH",n.priority=1,n.prototype={constructor:n,activate:function(){this._meter=this.max,this.alive=!0,this.onActivate.dispatch(this._meter,this.entity)},change:function(t){return this.alive?(this._meter+=t,this._meter<=0?(this._meter=0,this.alive=!1,this.onDeath.dispatch(t,this.entity)):(this._meter>this.max+this.overage&&(this._meter=this.max,this.onFull.dispatch(t)),0>t?this.onDamage.dispatch(t):this.onHeal.dispatch(t)),this._meter):0},drain:function(t){return this.alive?(this._meter>this.max&&(this._meter-=t,this._meter<=this.max&&(this._meter=this.max,this.onFull.dispatch(t))),this._meter):0},dispose:function(){this.onDeath.dispose(),this.onDamage.dispose(),this.onHeal.dispose(),this.onFull.dispose(),this.entity=null,this.deathSignal=null,this.onDamage=null,this.onHeal=null,this.onFull=null}},n}({},von.utils_Tools,von.core_Base),von.components_graphics_EASELBitmap=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.image=null,this.width=0,this.height=0,o.merge(this,i),0===this.width&&(this.width=this.image.width),0===this.height&&(this.height=this.image.height),this.entity=t,this._display=new createjs.Bitmap(this.image),this.position=t.position,this.rotation=t.rotation,n.stage.addChild(this._display)};return h.accessor="view",h.className="VIEW_EASEL_BITMAP",h.priority=10,h.prototype={constructor:h,configure:function(t){o.merge(this._display,t)},activate:function(){this._display.x=this.position.x,this._display.y=this.position.y,this._display.visible=!0,this.active=!0},disable:function(){this._display.visible=!1,this.active=!1},update:function(){!this.rotation||0===this.rotation.y&&0===this.rotation.x||(this._display.rotation=57.2957795*Math.atan2(this.rotation.y,this.rotation.x)),this._display.x=this.position.x,this._display.y=this.position.y},dispose:function(){this.entity=null,this.position=null}},h}({},von.core_Kai,von.utils_Tools,von.core_Base),von.components_input_TwinStickMovement=function(t,i,e){var s=i,n=function(t,i){e.call(this),this.speed=1,this.pad=null,s.merge(this,i),this.entity=t,this.accel=t.accel,this.rotation=t.rotation,this.active=!1};return n.accessor="input",n.className="INPUT_TWINSTICK",n.priority=20,n.prototype={constructor:n,activate:function(){this.accel.x=this.accel.y=0,this.rotation.x=this.rotation.y=0,this.active=!0},update:function(){this.accel.copy(this.pad.leftAxis).multiplyScalar(this.speed),this.rotation.copy(this.pad.rightAxis)},dispose:function(){this.entity=null,this.accel=null,this.rotation=null}},n}({},von.utils_Tools,von.core_Base),von.components_Timer=function(t,i,e){var s=i,n=function(t,i){e.call(this),this.repeat=-1,this.immediateDispatch=!1,this.interval=1e3,s.merge(this,i),this.onInterval=new Signal,this.entity=t,this._timer=0,this._numTicks=0,this._currentRepeat=this.repeat,this.disable()};return n.accessor="timer",n.className="TIMER",n.priority=13,n.prototype={constructor:n,activate:function(){this._timer=performance.now(),this.active=!0,this._currentRepeat=this.repeat,this._numTicks=0,this.immediateDispatch&&(this._numTicks++,this.onInterval.dispatch(this._numTicks))},disable:function(){this.active=!1},reset:function(){this._timer=performance.now(),this._numTicks=0,this.active&&this.immediateDispatch&&(this._numTicks++,this.onInterval.dispatch(this._numTicks))},update:function(){if(performance.now()-this._timer>=this.interval){if(this._numTicks++,this.onInterval.dispatch(this._numTicks),-1!==this.repeat&&0===this._currentRepeat--)return void this.disable();this._timer=performance.now()}},dispose:function(){this.onInterval.dispose(),this.onInterval=null,this.entity=null}},n}({},von.utils_Tools,von.core_Base),von.math_MathTools={TAU:2*Math.PI,clamp:function(t,i,e){return Math.max(i,Math.min(e,t))},sign:function(){return number&&number/Math.abs(number)},random:function(t,i){return 1===arguments.length?Math.random()*t-.5*t:Math.random()*(i-t)+t},randomInt:function(t,i){return Math.floor(1===arguments.length?Math.random()*t-.5*t:Math.random()*(i-t+1)+t)}},von.components_behaviors_Wander=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.maxSpeed=20,this.jitterAngle=1,this.targetDistance=20,this.targetRadius=10,n.merge(this,i),this.entity=t,this._wanderAngle=0,this._circleCenter=new Vec2,this._displacement=new Vec2,this.position=t.position,this.velocity=t.velocity,this.accel=t.accel,this.rotation=t.rotation};return h.accessor="wander",h.className="WANDER_BEHAVIOR",h.priority=10,h.prototype={constructor:h,activate:function(){this.active=!0},disable:function(){this.active=!1},update:function(){this._circleCenter.copy(this.velocity),this._circleCenter.normalize(),this._circleCenter.multiplyScalar(this.targetDistance),this._displacement.reset(0,-1),this._displacement.multiplyScalar(this.targetRadius),this.setAngle(this._displacement,this._wanderAngle),this._wanderAngle+=Math.random()*this.jitterAngle-.5*this.jitterAngle,this.velocity.add(this._circleCenter.add(this._displacement)),this.velocity.truncate(this.maxSpeed),this.rotation.copy(this.velocity)},setAngle:function(t,i){var e=t.getLength();t.x=Math.cos(i)*e,t.y=Math.sin(i)*e},getShortRotation:function(t){return t%=o.TAU,t>Math.PI?t-=o.TAU:t<-Math.PI&&(t+=o.TAU),t},dispose:function(){this.entity=null,this.position=null}},h}({},von.utils_Tools,von.math_MathTools,von.core_Base),von.components_GridTargeter=function(t,i,e,s){var n=i,o=e,h=function(t,i){s.call(this),this.searchInterval=1e3,this.scanRadius=400,this.collisionId=t.collisionId,this.target=null,o.merge(this,i),this.entity=t,this._nearby=new LinkedList,this._grid=n.broadphase,this._timer=0,this.position=t.position};return h.accessor="gridTargeter",h.className="GRID_TARGETER",h.priority=10,h.prototype={constructor:h,activate:function(){this.active=!0,this.target=null,this.collisionId=this.entity.collisionId,this._findTarget()},disable:function(){this.active=!1,this.target=null},update:function(){performance.now()-this._timer>=this.searchInterval&&(this._findTarget(),this._timer=performance.now())},dispose:function(){this.entity=null,this.position=null},_findTarget:function(){var t,i;for(this._nearby.clear(),this._grid.getNearby(this.position,this.scanRadius,this._nearby),t=this._nearby.first;t;){if(i=t.obj,i&&i.entity.id!==this.entity.id)return void(this.target=i);t=t.next}this.target=null}},h}({},von.entities_World,von.utils_Tools,von.core_Base),von.components_VonComponents=function(){var t,i,e=arguments.length,s={};for(t=0;e>t;t++)i=arguments[t],s[i.className]={accessor:i.accessor,proto:i,index:t};return s}(von.components_graphics_OCANSquare,von.components_physics_AABB2,von.components_graphics_OCANCircle,von.components_physics_RadialCollider2,von.components_graphics_THREECube,von.components_physics_AABB3,von.components_physics_CollisionGridScanner,von.components_Health,von.components_graphics_EASELBitmap,von.components_input_TwinStickMovement,von.components_Timer,von.components_behaviors_Wander,von.components_GridTargeter);