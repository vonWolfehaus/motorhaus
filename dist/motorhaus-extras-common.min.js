mh.GamepadController=function(){this.controllers=[],this.onConnect=new mh.Signal,this.onDisconnect=new mh.Signal,this.activeControllers=0,this._controllerStatus=[];for(var t=0;4>t;t++)this.controllers[t]=new mh.XboxGamepad(t),this._controllerStatus[t]=!1;window.addEventListener("gamepadconnected",this._onConnect.bind(this),!1),window.addEventListener("gamepaddisconnected",this._onDisconnect.bind(this),!1)},mh.GamepadController.prototype={constructor:mh.GamepadController,update:function(){var t,i;for(navigator.webkitGetGamepads&&this._scan(),t=0;4>t;t++)i=this.controllers[t],i.active&&i.update()},dispose:function(){this.controllers=null,this.onConnect.dispose(),this.onDisconnect.dispose(),this.onConnect=null,this.onDisconnect=null,this._controllerStatus=null},_addPad:function(t){var i=this.controllers[t.index];i.register(t),i.activate(),this.onConnect.dispatch(i),this.activeControllers++},_removePad:function(t){var i=t.index?this.controllers[t.index]:this.controllers[t];i.unregister(),this.onDisconnect.dispatch(i),this.activeControllers--},_onConnect:function(t){this._addPad(t.gamepad)},_onDisconnect:function(t){this._removePad(t.gamepad)},_scan:function(){var t,i=navigator.webkitGetGamepads();for(t=0;t<i.length;t++)i[t]?this._controllerStatus[t]?this.controllers[t].setPad(i[t]):(this._addPad(i[t]),this._controllerStatus[t]=!0):!i[t]&&this._controllerStatus[t]&&(this._removePad(t),this._controllerStatus[t]=!1)}},mh.KeyboardController=function(){this.key=-1,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.shift=!1,this.ctrl=!1,this._keys={},this._prev=null,document.addEventListener("keydown",this._processDown.bind(this),!1),document.addEventListener("keyup",this._processUp.bind(this),!1)},mh.KeyboardController.prototype={constructor:mh.KeyboardController,_processDown:function(t){var i=this._keys[t.keyCode];return mh.kai.inputBlocked||this.key===this._prev?void t.preventDefault():(this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey,this.key=t.keyCode,i&&i.isDown?this._keys[t.keyCode].duration=performance.now()-i.timeDown:i?(this._keys[t.keyCode].isDown=!0,this._keys[t.keyCode].timeDown=performance.now(),this._keys[t.keyCode].duration=0):this._keys[t.keyCode]={isDown:!0,timeDown:performance.now(),timeUp:0,duration:0},this.onDown.dispatch(this.key),void(this._prev=this.key))},_processUp:function(t){return mh.kai.inputBlocked?void t.preventDefault():(this.key=-1,this.shift=!1,this.ctrl=!1,this._keys[t.keyCode]?(this._keys[t.keyCode].isDown=!1,this._keys[t.keyCode].timeUp=performance.now()):this._keys[t.keyCode]={isDown:!1,timeDown:performance.now(),timeUp:performance.now(),duration:0},void this.onUp.dispatch(t.keyCode,this._keys[t.keyCode].timeUp-this._keys[t.keyCode].timeDown))},activate:function(){for(var t in this._keys)this._keys[t].isDown=!1},justPressed:function(t,i){return"undefined"==typeof i&&(i=100),this._keys[t]&&this._keys[t].isDown&&this._keys[t].duration<i?!0:!1},justReleased:function(t,i){return"undefined"==typeof i&&(i=100),this._keys[t]&&this._keys[t].isDown===!1&&performance.now()-this._keys[t].timeUp<i?!0:!1},isDown:function(t){return this._keys[t]?this._keys[t].isDown:!1},A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,UNDERSCORE:189,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},mh.MouseController=function(){this.position=new mh.Vec2,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.down=!1,this.shift=!1,this.ctrl=!1,document.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mouseout",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("contextmenu",this.onMouseContext,!1)},mh.MouseController.prototype={constructor:mh.MouseController,onMouseDown:function(t){return mh.kai.inputBlocked?void t.preventDefault():(this.position.x=t.pageX,this.position.y=t.pageY,this.down=!0,this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey,void this.onDown.dispatch(this.position))},onMouseUp:function(t){return!this.down||mh.kai.inputBlocked?void t.preventDefault():(this.position.x=t.pageX,this.position.y=t.pageY,this.down=!1,this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey,void this.onUp.dispatch(this.position))},onMouseMove:function(t){t.preventDefault(),this.position.x=t.pageX,this.position.y=t.pageY,this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey},onMouseContext:function(t){return t.preventDefault(),!1}},mh.TwinStickMovement=function(t,i){i=i||{},mh.Base.call(this),this.speed=1,this.pad=null,mh.util.overwrite(this,i),this.entity=t,this.accel=t.accel,this.rotation=t.rotation,this.active=!1},mh.TwinStickMovement.accessor="input",mh.TwinStickMovement.className="INPUT_TWINSTICK",mh.TwinStickMovement.priority=20,mh.TwinStickMovement.prototype={constructor:mh.TwinStickMovement,activate:function(){this.accel.x=this.accel.y=0,this.rotation.x=this.rotation.y=0,this.active=!0},disable:function(){this.active=!1},update:function(){this.accel.copy(this.pad.leftAxis).multiplyScalar(this.speed),this.rotation.copy(this.pad.rightAxis)},dispose:function(){this.entity=null,this.accel=null,this.rotation=null}},mh.XboxGamepad=function(t){mh.Base.call(this),this.id=t,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.leftAxis=new mh.Vec2,this.rightAxis=new mh.Vec2,this.leftTrigger=0,this.rightTrigger=0,this.axisTolerance=.2,this.controller=null,this.buttons=null,this._numButtons=0,this._mozAxisOffset=0,this._prevButtons=[]},mh.XboxGamepad.prototype={constructor:mh.XboxGamepad,register:function(t){this.setPad(t),this._numButtons=this.buttons.length,navigator.webkitGetGamepads?this._mozAxisOffset=0:this._mozAxisOffset=1,this.activate()},setPad:function(t){this.controller=t,this.buttons=t.buttons},unregister:function(){this.controller=null,this.buttons=null,this._numButtons=0},update:function(){var t,i,e=this.controller.axes[0],s=this.controller.axes[1],n=this.controller.axes[2+this._mozAxisOffset],o=this.controller.axes[3+this._mozAxisOffset];for(e<this.axisTolerance&&e>-this.axisTolerance&&(e=0),s<this.axisTolerance&&s>-this.axisTolerance&&(s=0),n<this.axisTolerance&&n>-this.axisTolerance&&(n=0),o<this.axisTolerance&&o>-this.axisTolerance&&(o=0),this.leftAxis.x=e,this.leftAxis.y=s,this.rightAxis.x=n,this.rightAxis.y=o,t=0;t<this._numButtons;t++)i=this.buttons[t],6===t?this.leftTrigger=i.value||i:7===t&&(this.rightTrigger=i.value||i),i&&!this._prevButtons[t]?this.onDown.dispatch(t,i):!i&&this._prevButtons[t]&&this.onUp.dispatch(t,i),this._prevButtons[t]=i},isDown:function(t){return mh.kai.inputBlocked||!this.active?!1:!!this.buttons[t]},activate:function(){this.active=!0,this.leftAxis.x=0,this.leftAxis.y=0,this.rightAxis.x=0,this.rightAxis.y=0,this.leftTrigger=0,this.rightTrigger=0;for(var t=0;t<this._numButtons;t++)this.buttons[t]=0,this._prevButtons[t]=0},disable:function(){this.active=!1},dispose:function(){this.onDown.dispose(),this.onUp.dispose(),this.onDown=null,this.onUp=null}},mh.XBOX={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,SELECT:8,START:9,LSTICK:10,RSTICK:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},mh.Health=function(t,i){i=i||{},mh.Base.call(this),this.max=100,this.overage=0,this.alive=!1,this.active=!1,mh.util.overwrite(this,i),this.onDeath=new mh.Signal,this.onDamage=new mh.Signal,this.onHeal=new mh.Signal,this.onFull=new mh.Signal,this.onActivate=new mh.Signal,this.entity=t,this._meter=0},mh.Health.accessor="health",mh.Health.className="HEALTH",mh.Health.priority=1,mh.Health.prototype={constructor:mh.Health,activate:function(){this._meter=this.max,this.alive=!0,this.onActivate.dispatch(this._meter,this.entity)},change:function(t){return this.alive?(this._meter+=t,this._meter<=0?(this._meter=0,this.alive=!1,this.onDeath.dispatch(t,this.entity)):(this._meter>this.max+this.overage&&(this._meter=this.max,this.onFull.dispatch(t)),0>t?this.onDamage.dispatch(t):this.onHeal.dispatch(t)),this._meter):0},drain:function(t){return this.alive?(this._meter>this.max&&(this._meter-=t,this._meter<=this.max&&(this._meter=this.max,this.onFull.dispatch(t))),this._meter):0},dispose:function(){this.onDeath.dispose(),this.onDamage.dispose(),this.onHeal.dispose(),this.onFull.dispose(),this.entity=null,this.deathSignal=null,this.onDamage=null,this.onHeal=null,this.onFull=null}},mh.StackFSM=function(t){mh.Base.call(this),this.state=null,this.stack=[],this.entity=t,this.stateChanged=new mh.Signal,this._activeContext=null,this._activeFunction=null,this._prevFunction=null},mh.StackFSM.accessor="stack",mh.StackFSM.className="STACK_FSM",mh.StackFSM.priority=5,mh.StackFSM.post=!1,mh.StackFSM.prototype={constructor:mh.StackFSM,activate:function(){this.active=!0},disable:function(){this.active=!1,this.reset()},reset:function(){this.stack.length=0,this._prevFunction=null,this._activeFunction=null},pushState:function(t,i){t!==this._activeFunction&&(this.stack.push(t),this._activeContext=i,this.active||this.activate())},popState:function(){this.stack.pop(),this._activeFunction=this.stack.length?this.stack[this.stack.length-1]:null,this._activeFunction||(this.stateChanged.dispatch(this.state,"null"),this._prevFunction=null,this.disable())},update:function(){this._activeFunction=this.stack.length?this.stack[this.stack.length-1]:null,this._activeFunction&&(this._activeFunction!==this._prevFunction&&(this.state=this._activeFunction.name,this.stateChanged.dispatch(this._prevFunction?this._prevFunction.name:"null",this.state),this._prevFunction=this._activeFunction),this._activeFunction.call(this._activeContext))},dispose:function(){this.entity=null,this._activeFunction=null,this._prevFunction=null,this.stack=null,this.stateChanged.dispose(),this.stateChanged=null}};
//# sourceMappingURL=motorhaus-extras-common.min.js.map
