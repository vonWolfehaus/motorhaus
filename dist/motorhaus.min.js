window.mh={version:"0.5.0"},mh.Base=function(){this.uniqueID=Math.random().toString(36).slice(2)+Date.now(),this.active=!1},mh.Engine=function(){mh.kai.debugMessages&&console.log("[Engine] Initializing"),mh.Component={},this.state=new mh.StateManager,this._paused=!1;var t=this;this._onInit=function(){return t.init()},"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(this._onInit,0):(document.addEventListener("DOMContentLoaded",this._onInit,!1),window.addEventListener("load",this._onInit,!1))},mh.Engine.prototype={constructor:mh.Engine,init:function(){if(!mh.kai.ready){var t=this;if(!document.body)return void window.setTimeout(this._onInit,20);document.removeEventListener("DOMContentLoaded",this._onInit),window.removeEventListener("load",this._onInit),window.addEventListener("focus",function(e){t._paused=!1,mh.tower.resume.dispatch()},!1),window.addEventListener("blur",function(e){t._paused=!0,mh.tower.pause.dispatch()},!1),mh.kai.engine=this,mh.kai.ready=!0,mh.kai.debugMessages&&console.log("[Engine] Ready"),this.state.init(),mh.kai.inputBlocked=!1,this.updateBound=this.update.bind(this),this.updateBound()}},start:function(t){mh.kai.ready||(this.state.queue(t),this.state.next())},update:function(){var t,e,n,i=mh.kai.componentsSorted,s=i.length;if(this._paused)return void requestAnimationFrame(this.updateBound);if(this.state.ready){for(mh.kai.debugCtx&&mh.kai.debugCtx.clearRect(0,0,mh.kai.width,mh.kai.height),t=0;s>t;t++)if(i[t]&&(e=i[t].first,!e||e.obj.update))for(;e;)n=e.obj,n.active&&n.update(),e=e.next;this.state.current.update()}requestAnimationFrame(this.updateBound)},dispose:function(){}},mh.kai={engine:null,view:null,mouse:null,keys:null,pads:null,debugCtx:null,debugMessages:!0,components:[],componentsSorted:[],componentDefinitions:[],numComponents:0,width:window.innerWidth,height:window.innerHeight,ready:!1,inputBlocked:!0,expect:function(t,e,n){var i;if(!t[e])if(n)t[e]=new n;else{for(i=0;i<this.componentDefinitions.length&&(n=this.componentDefinitions[i],n.accessor!==e);i++);if(!n)throw new Error('[Kai.expect] The component "'+e+'" does not exist. You might have forgotten to create a component list object (just like VonComponents.js), or forgot to add this component to that list.');this.addComponent(t,n),this.debugMessages&&console.info("[Kai.expect] "+e.toUpperCase()+" component was added to "+t.toString()+" with default values")}return t[e]},registerComponents:function(t){function e(t,e){return t.priority-e.priority}var n,i,s,o,r=t.length,h={};for(n=0;r>n;n++)o=t[n],i=this.numComponents,h[o.className]={accessor:o.accessor,proto:o,index:i,priority:o.priority},this.numComponents++,this.components[i]||(s=new mh.LinkedList,s.priority=o.priority,this.components[i]=s,this.componentDefinitions[i]=h[o.className],mh.Component[o.className]=h[o.className],this.componentsSorted[i]=s,this.debugMessages&&console.info("[Kai] Registered "+o.className));return this.componentsSorted.sort(e),h},addComponent:function(t,e,n,i){var s=e.accessor,o=null;return n=n||null,t.hasOwnProperty(s)?void(this.debugMessages&&console.warn('[Kai.addComponent] "'+s+'" already exists on entity '+t.toString())):(o=new e.proto(t,n),this.components[e.index].add(o),void("undefined"==typeof i?t[s]=o:i.push(o)))},removeComponent:function(t,e){var n=e.accessor;t.hasOwnProperty(n)&&(this.components[e.index].remove(t[n]),t[n].dispose(),t[n]=null)}},mh.LinkedListNode=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0},mh.LinkedList=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueID=Date.now()+""+Math.floor(1e3*Math.random()),this.priority=0},mh.LinkedList.prototype={constructor:mh.LinkedList,getNode:function(t){return this.objToNodeMap[t.uniqueID]},addNode:function(t){var e=new mh.LinkedListNode;return e.obj=t,e.prev=null,e.next=null,e.free=!1,this.objToNodeMap[t.uniqueID]=e,e},swapObjects:function(t,e){this.objToNodeMap[t.obj.uniqueID]=null,this.objToNodeMap[e.uniqueID]=t,t.obj=e},add:function(t){var e=this.objToNodeMap[t.uniqueID];if(e){if(!e.free)return void console.log("what");e.obj=t,e.free=!1,e.next=null,e.prev=null}else e=this.addNode(t);if(this.first){if(null==this.last)throw new Error("Hmm, no last in the list -- that shouldn't happen here");this.last.next=e,e.prev=this.last,this.last=e,e.next=null}else this.first=e,this.last=e,e.next=null,e.prev=null;this.length++,this.showDebug&&this.dump("after add")},has:function(t){return!!this.objToNodeMap[t.uniqueID]},moveUp:function(t){this.dump("before move up");var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.prev){var n=e.prev,i=n.prev;e==this.last&&(this.last=n);var s=e.next;i&&(i.next=e),e.next=n,e.prev=n.prev,n.next=s,n.prev=e,this.first==n&&(this.first=e)}},moveDown:function(t){var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.next){var n=e.next;this.moveUp(n.obj),this.last==n&&(this.last=e)}},sort:function(t){for(var e,n,i=[],s=this.first;s;)i.push(s.object()),s=s.next();for(this.clear(),i.sort(t),n=i.length,e=0;n>e;e++)this.add(i[e])},remove:function(t){var e=this.objToNodeMap[t.uniqueID];return null==e||1==e.free?!1:(null!=e.prev&&(e.prev.next=e.next),null!=e.next&&(e.next.prev=e.prev),null==e.prev&&(this.first=e.next),null==e.next&&(this.last=e.prev),e.free=!0,e.prev=null,e.next=null,this.length--,!0)},shift:function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},pop:function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},concat:function(t){for(var e=t.first;e;)this.add(e.obj),e=e.next},clear:function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},dispose:function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},dump:function(t){console.log("===================="+t+"=====================");for(var e=this.first;null!=e;)console.log("{"+e.obj.toString()+"} previous="+(e.prev?e.prev.obj:"NULL")),e=e.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}},mh.SignalBinding=function(t,e,n,i,s){"undefined"==typeof s&&(s=0),this.active=!0,this.params=null,this._listener=e,this._isOnce=n,this.context=i,this._signal=t,this.priority=s||0},mh.SignalBinding.prototype={constructor:mh.SignalBinding,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},mh.Signal=function(){this._bindings=[],this._prevParams=null,this.memorize=!1,this._shouldPropagate=!0,this.active=!0},mh.Signal.prototype={constructor:mh.Signal,validateListener:function(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,e,n,i){var s,o=this._indexOfListener(t,n);if(-1!==o){if(s=this._bindings[o],s.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new mh.SignalBinding(this,t,e,n,i),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t.priority<=this._bindings[e].priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,i=this._bindings.length;i--;)if(n=this._bindings[i],n.getListener()===t&&n.context===e)return i;return-1},has:function(t,e){return"undefined"==typeof e&&(e=null),-1!==this._indexOfListener(t,e)},add:function(t,e,n){return"undefined"==typeof e&&(e=null),"undefined"==typeof n&&(n=0),this.validateListener(t,"add"),this._registerListener(t,!1,e,n)},addOnce:function(t,e,n){return"undefined"==typeof e&&(e=null),"undefined"==typeof n&&(n=0),this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,n)},remove:function(t,e){"undefined"==typeof e&&(e=null),this.validateListener(t,"remove");var n=this._indexOfListener(t,e);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];if(this.active){var n,i=this._bindings.length;if(this.memorize&&(this._prevParams=t),i){n=this._bindings.slice(0),this._shouldPropagate=!0;do i--;while(n[i]&&this._shouldPropagate&&n[i].execute(t)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},mh.StateManager=function(){this.states={},this.current=null,this.currentKey=null,this.ready=!1,this._q=[]},mh.StateManager.prototype={constructor:mh.StateManager,init:function(){mh.tower.requestState.add(function(t){this.queue(t),this.next()},this),this.next()},add:function(t,e){return this.checkState(t,e)!==!1?(this.states[t]=e,this):void 0},remove:function(t){delete this.states[t]},queue:function(t){return this.states[t]?(this._q.push(t),this):void console.warn("[StateManager.queue] "+t+" not found; add it first")},next:function(){return 0===this._q.length||mh.kai.ready===!1?void console.log("[StateManager.next] _q length: "+this._q.length+"; Engine ready: "+mh.kai.ready):(this.ready=!1,mh.kai.inputBlocked=!0,this.currentKey&&(this.current=this.states[this.currentKey],this.current.dispose()),this.currentKey=this._q.shift(),this.current=this.states[this.currentKey],this.current.create(),mh.kai.inputBlocked=!1,this.ready=!0,this)},checkState:function(t,e){return this.states[t]?(console.error("[StateManager.checkState] Duplicate key: "+t),!1):"function"==typeof e?(console.error("[StateManager.checkState] States must be object literals, not functions"),!1):e?e.create&&e.update&&e.dispose?!0:(console.error('[StateManager.checkState] Invalid State "'+t+'" given. Must contain all required functions: create, update, dispose'),!1):(console.error("[StateManager.checkState] No state found with the key: "+t),!1)},dispose:function(){this.states=null,this.idxOnes=null}},mh.world={width:1,height:1,depth:1,scale:1,gravity:8,friction:.98,elapsed:.01666,broadphase:null,map:null,mainCamera:null,cameras:null},mh.tower={requestState:new mh.Signal,pause:new mh.Signal,resume:new mh.Signal},mh.debugDraw={circle:function(t,e,n,i,s){s=s||"rgb(200, 10, 30)",t.beginPath(),t.arc(e,n,i,0,mh.util.TAU),t.lineWidth=1,t.strokeStyle=s,t.stroke()},point:function(t,e,n,i){i=i||"rgb(200, 10, 30)",n=n||3,t.beginPath(),t.arc(e.x,e.y,n,0,mh.util.TAU),t.fillStyle=i,t.fill()},vector:function(t,e,n,i){i=i||"rgb(200, 10, 30)",t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(e.x+n.x,e.y+n.y),t.lineWidth=1,t.strokeStyle=i,t.stroke()},vectorLine:function(t,e,n,i){i=i||"rgb(200, 10, 30)",t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.lineWidth=1,t.strokeStyle=i,t.stroke()},rectangle:function(t,e,n,i,s,o){o=o||"rgb(200, 10, 30)",t.beginPath(),t.lineWidth=1,t.strokeStyle=o,t.strokeRect(e-.5*i,n-.5*s,i,s)}},mh.DualPool=function(t,e,n){this._Class=t,this.size=e,this._freeList=new mh.LinkedList,this._busyList=new mh.LinkedList,this._settings=n||{},this._settings.pool=this;for(var i=0;i<this.size;i++)this._freeList.add(new this._Class(this._settings))},mh.DualPool.prototype={constructor:mh.DualPool,get:function(){var t;return this._freeList.length?(t=this._freeList.pop(),this._busyList.add(t),t):(t=new this._Class(this._settings),this._busyList.add(t),this.size++,t)},recycle:function(t){this._busyList.has(t)&&(this._busyList.remove(t),this._freeList.add(t))},freeAll:function(){for(var t,e=this._busyList.first;e;)t=e.obj,e=e.next,this._busyList.remove(t),this._freeList.add(t)},dispose:function(){this._freeList.dispose(),this._busyList.dispose(),this._freeList=null,this._busyList=null,this._Class=null,this._settings=null},toString:function(){return"[DualPool size: "+this.size+", free: "+this._freeList.length+", busy: "+this._busyList.length+"]"}},mh.util={PI:Math.PI,TAU:2*Math.PI,DEG_TO_RAD:.0174532925,RAD_TO_DEG:57.2957795,clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},sign:function(t){return t&&t/Math.abs(t)},random:function(t,e){return 1===arguments.length?Math.random()*t-.5*t:Math.random()*(e-t)+t},randomInt:function(t,e){return 1===arguments.length?Math.floor(Math.random()*t-.5*t):Math.floor(Math.random()*(e-t+1)+t)},normalize:function(t,e,n){return(t-e)/(n-e)},getShortRotation:function(t){return t%=this.TAU,t>this.PI?t-=this.TAU:t<-this.PI&&(t+=this.TAU),t},generateID:function(){return Math.random().toString(36).slice(2)+Date.now()},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!Object.prototype.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},merge:function(t,e){var n=this,i=Array.isArray(e),s=i&&[]||{};return i?(t=t||[],s=s.concat(t),e.forEach(function(e,i){"undefined"==typeof s[i]?s[i]=e:n.isPlainObject(e)?s[i]=n.merge(t[i],e):-1===t.indexOf(e)&&s.push(e)}),s):(t&&n.isPlainObject(t)&&Object.keys(t).forEach(function(e){s[e]=t[e]}),Object.keys(e).forEach(function(i){e[i]&&n.isPlainObject(e[i])&&t[i]?s[i]=n.merge(t[i],e[i]):s[i]=e[i]}),s)},overwrite:function(t,e){for(var n in e)t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(t[n]=e[n])},now:function(){return window.nwf?window.nwf.system.Performance.elapsedTime:window.performance.now()},empty:function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},radixSort:function(t,e,n,i){if(e=e||0,n=n||t.length,i=i||31,!(e>=n-1||0>i)){for(var s=e,o=n,r=1<<i;o>s;)if(t[s]&r){--o;var h=t[s];t[s]=t[o],t[o]=h}else++s;this.radixSort(t,e,o,i-1),this.radixSort(t,o,n,i-1)}}};
//# sourceMappingURL=motorhaus.min.js.map
