mh.Camera2=function(t){t=t||{},mh.Base.call(this),this.width=mh.kai.width,this.height=mh.kai.height,this.scalable=!1,this.scale=1,this.minScale=.3,this.maxScale=1,this.scalePadding=100,this.target=null,this.targets=null,this.displayObject=null,this.deadzone=null,this.bounds=new mh.Rectangle(0,0,mh.world.width,mh.world.height),mh.util.overwrite(this,t),this.position=new mh.Vec2,this.atLimit={x:!1,y:!1},this._edge=0},mh.Camera2.FOLLOW_LOCKON=0,mh.Camera2.FOLLOW_PLATFORMER=1,mh.Camera2.FOLLOW_TOPDOWN_LOOSE=2,mh.Camera2.FOLLOW_TOPDOWN=3,mh.Camera2.FOLLOW_TOPDOWN_TIGHT=4,mh.Camera2.prototype={follow:function(t,i){"undefined"==typeof i&&(i=mh.Camera2.FOLLOW_TOPDOWN),"[object Array]"===Object.prototype.toString.call(t)?(console.log("[Camera2.follow] Tracking multiple targets"),this.target=new mh.Vec2,this.targets=t):this.target=t;var e;switch(i){case mh.Camera2.FOLLOW_PLATFORMER:var s=this.width/8,h=this.height/3;this.deadzone=new mh.Rectangle((this.width-s)/2,(this.height-h)/2-.25*h,s,h);break;case mh.Camera2.FOLLOW_TOPDOWN_LOOSE:e=Math.max(this.width,this.height)/2,this.deadzone=new mh.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case mh.Camera2.FOLLOW_TOPDOWN:e=Math.max(this.width,this.height)/4,this.deadzone=new mh.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case mh.Camera2.FOLLOW_TOPDOWN_TIGHT:e=Math.max(this.width,this.height)/8,this.deadzone=new mh.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case mh.Camera2.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},focusOn:function(t){this.setPosition(Math.round(t.x-.5*this.width),Math.round(t.y-.5*this.height))},focusOnXY:function(t,i){this.setPosition(Math.round(t-.5*this.width),Math.round(i-.5*this.height))},update:function(){this.target&&this.updateTarget(),this.bounds&&this.checkBounds(),this.scalable&&(this.displayObject.scale.x=this.scale,this.displayObject.scale.y=this.scale),this.displayObject.x=-this.position.x,this.displayObject.y=-this.position.y},updateTarget:function(){var t,i,e,s,h,o,n,a,r,c,l,d,u,m;if(this.targets){for(d=this.targets.length,m=0,i=Number.MAX_VALUE,e=Number.MAX_VALUE,s=Number.MIN_VALUE,h=Number.MIN_VALUE,t=0;d>t;t++)l=this.targets[t],l.active&&(m++,u=l,c=l.position,c.x<i&&(i=c.x),c.y<e&&(e=c.y),c.x>s&&(s=c.x),c.y>h&&(h=c.y));m>1?(this.target.x=.5*(i+s),this.target.y=.5*(e+h),this.scalable&&(this.scale=1,o=s-i+this.scalePadding,n=h-e+this.scalePadding,a=0===o?1:mh.kai.width/o,r=0===n?1:mh.kai.height/n,r>a?this.scale=a:this.scale=r,this.scale<this.minScale?this.scale=this.minScale:this.scale>this.maxScale&&(this.scale=this.maxScale),this.target.x*=this.scale,this.target.y*=this.scale)):1===m&&(this.target.x=u.position.x,this.target.y=u.position.y,this.scale=1)}this.deadzone?(this._edge=this.target.x-this.deadzone.x,this.position.x>this._edge&&(this.position.x=this._edge),this._edge=this.target.x-this.deadzone.x-this.deadzone.width,this.position.x<this._edge&&(this.position.x=this._edge),this._edge=this.target.y-this.deadzone.y,this.position.y>this._edge&&(this.position.y=this._edge),this._edge=this.target.y-this.deadzone.y-this.deadzone.height,this.position.y<this._edge&&(this.position.y=this._edge)):this.focusOnXY(this.target.x,this.target.y)},setBoundsToWorld:function(){this.bounds.setTo(0,0,mh.world.width,mh.world.height)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.position.x<this.bounds.x&&(this.atLimit.x=!0,this.position.x=this.bounds.x),this.position.x>this.bounds.right-this.width&&(this.atLimit.x=!0,this.position.x=this.bounds.right-this.width+1),this.position.y<this.bounds.top&&(this.atLimit.y=!0,this.position.y=this.bounds.top),this.position.y>this.bounds.bottom-this.height&&(this.atLimit.y=!0,this.position.y=this.bounds.bottom-this.height+1),this.position.x=Math.floor(this.position.x),this.position.y=Math.floor(this.position.y)},setPosition:function(t,i){this.position.x=t,this.position.y=i,this.bounds&&this.checkBounds()},setSize:function(t,i){this.width=t,this.height=i}},mh.Emitter=function(t,i){if(i=i||{},mh.Base.call(this),this.width=10,this.height=10,this.container=mh.mh.kai.stage,this.blend=!1,this.emitType=mh.Emitter.EmitType.Point,this.emitDuration=-1,this.emitAngle=0,this.emitAngleVar=mh.util.TAU,this.emitSpeed=10,this.emitSpeedVar=0,this.emitRate=30,this.particleDuration=1,this.particleDurationVar=0,this.particleScaleInit=1,this.particleScaleVar=0,this.particleAlphaInit=1,this.particleAlphaAccel=-2,this.particleAlphaAccelDelay=.5,this.particleRotationAccel=0,this.particleRotationAccelVar=.2,this.particleRadialAccel=0,this.particleRadialAccelVar=0,this.particleTangentialAccel=0,this.particleTangentialAccelVar=0,this.particleGravity=null,mh.util.overwrite(this,i),this.particleGravity=this.particleGravity||{x:0,y:0},this.entity=t||null,this.duration=0,this.position=new mh.Vec2,!this.uri)throw new Error("[Emitter] You must pass in an image uri through the settings parameter");this.texture=PIXI.Texture.fromImage(i.uri),this.uuid=mh.util.generateID(),this.active=!1,this._force=new mh.Vec2,this._vec=new mh.Vec2,this._emitTimer=0,this._pool=new mh.DualPool(mh.Particle,this,15),this._emissionSum=0},mh.Emitter.prototype=Object.create(PIXI.SpriteBatch.prototype),mh.Emitter.prototype.constructor=mh.Emitter,mh.Emitter.accessor="emitter",mh.Emitter.className="EMITTER",mh.Emitter.priority=50,mh.Emitter.prototype.activate=function(){this.active=!0,this.container.addChild(this),this.visible=!0,this.duration=0,this._emissionSum=this.emitRate*mh.kai.elapsed},mh.Emitter.prototype.disable=function(){this.active=!1,this.container.removeChild(this),this._pool.freeAll()},mh.Emitter.prototype.update=function(){var t,i,e,s=this._pool.busy;if(this.duration+=mh.kai.elapsed,-1===this.emitDuration||this.duration<this.emitDuration)this._emissionSum+=this.emitRate*mh.kai.elapsed,this._emissionSum>=1&&(t=Math.floor(this._emissionSum),this.emit(t),this._emissionSum-=t);else if(0===this._pool.busy.length)return void this.disable();for(e=s.first;e;)i=e.obj,e=e.next,i.duration+=mh.kai.elapsed,i.alpha<0||i.duration>=this.particleDuration?(i.visible=!1,this._pool.recycle(i)):(i.fadeDelay<=0?i.alpha+=this.particleAlphaAccel*mh.kai.elapsed:i.fadeDelay-=mh.kai.elapsed,this._vec.set(i.vx,i.vy),this._force.copy(this._vec),this._force.multiplyScalar(i.radialAccel),this._vec.normalize(),this._vec.perp(),this._vec.multiplyScalar(i.tangentialAccel),i.vx+=(this._force.x+this._vec.x+this.particleGravity.x)*mh.kai.elapsed,i.vy+=(this._force.y+this._vec.y+this.particleGravity.y)*mh.kai.elapsed,i.position.x+=i.vx*mh.kai.elapsed,i.position.y+=i.vy*mh.kai.elapsed,i.rotation+=i.rotationAccel*mh.kai.elapsed)},mh.Emitter.prototype.dispose=function(){this.removeChildren(),this.texture.destroy(),this._pool.dispose(),this._pool=null,this.forces=null},mh.Emitter.prototype.emit=function(t){var i,e,s,h,o=mh.Emitter.EmitType;for(e=0;t>e;e++)switch(h=this._pool.get(),h.activate(),h.duration=mh.util.random(this.particleDurationVar),h.rotation=mh.util.random(this.particleRotationAccelVar*mh.util.TAU),s=this.particleScaleInit+mh.util.random(this.particleScaleVar),h.scale.set(s,s),h.alpha=this.particleAlphaInit,h.fadeDelay=this.particleAlphaAccelDelay,h.blendMode=this.blend?PIXI.blendModes.ADD:PIXI.blendModes.NORMAL,i=this.emitAngle+mh.util.random(this.emitAngleVar),s=this.emitSpeed+mh.util.random(this.emitSpeedVar),h.vx=Math.cos(i)*s,h.vy=-Math.sin(i)*s,h.radialAccel=this.particleRadialAccel+mh.util.random(this.particleRadialAccelVar),h.tangentialAccel=this.particleTangentialAccel+mh.util.random(this.particleTangentialAccelVar),h.rotationAccel=this.particleRotationAccel+mh.util.random(this.particleRotationAccelVar),this.emitType){case o.Rect:h.position.x=mh.util.randomInt(this._width),h.position.y=mh.util.randomInt(this._height);break;case o.Circle:i=Math.random()*mh.util.TAU,s=Math.random(),h.position.x=s*this._width*Math.cos(i),h.position.y=s*this._height*Math.sin(i);break;case o.CircleUniform:i=Math.random()*mh.util.TAU,s=Math.sqrt(Math.random()),h.position.x=s*this._width*Math.cos(i),h.position.y=s*this._height*Math.sin(i);break;case o.Ring:i=mh.util.random(mh.util.TAU),h.position.x=Math.cos(i)*this._width,h.position.y=Math.sin(i)*this._height;break;default:h.position.x=0,h.position.y=0}},mh.Emitter.EmitType={Point:0,Rect:2,Circle:4,CircleUniform:5,Ring:6},mh.Particle=function(t){PIXI.Sprite.call(this,t.texture),this.uuid=mh.util.generateID(),t.addChildAt(this,0),this.anchor.set(.5,.5),this.active=!1,this.visible=!1,this.duration=0,this.fadeDelay=0,this.vx=0,this.vy=0,this.radialAccel=0,this.tangentialAccel=0,this.rotationAccel=0},mh.Particle.prototype=Object.create(PIXI.Sprite.prototype),mh.Particle.prototype.constructor=mh.Particle,mh.Particle.prototype.activate=function(){this.active=!0,this.visible=!0,this.alpha=1,this.duration=0,this.rotation=0,this.vx=0,this.vy=0,this.radialAccel=0,this.tangentialAccel=0,this.rotationAccel=0},mh.Particle.prototype.disable=function(){this.active=!1,this.visible=!1},mh.FlowGrid=function(t,i,e){this.cellPixelSize=t,this.widthInCells=Math.floor(i/t)+1,this.heightInCells=Math.floor(e/t)+1,this.numCells=this.widthInCells*this.heightInCells,this.grid=[],this.goal=new mh.Vec2,this.goalPixels=new mh.Vec2,this._openList=new mh.LinkedList,this._sizeMulti=1/this.cellPixelSize;var s,h;for(s=0;s<this.widthInCells;s++)for(this.grid[s]=[],h=0;h<this.heightInCells;h++)this.grid[s][h]=new mh.FlowGridNode(s,h);mh.kai.flow=this,console.log("[FlowGrid] "+this.widthInCells+"x"+this.heightInCells)},mh.FlowGrid.prototype={setGoal:function(t,i){var e=~~(t*this._sizeMulti),s=~~(i*this._sizeMulti);if(0>e||0>s||e>=this.widthInCells||s>=this.heightInCells)throw new Error("[FlowGrid.build] Out of bounds");return this.goal.x===e&&this.goal.y===s?!1:(this.goal.x=e,this.goal.y=s,this.goalPixels.activate(t,i),!0)},build:function(){var t,i,e,s,h,o,n,a;for(t=0;t<this.widthInCells;t++)for(i=0;i<this.heightInCells;i++)this.grid[t][i].open=!0;for(this._openList.clear(),s=this.grid[this.goal.x][this.goal.y],s.cost=0,this._openList.add(s);this._openList.length;)s=this._openList.shift(),s.open=!1,e=this.grid[s.gridX][s.gridY],h=s.gridX-1>=0?this.grid[s.gridX-1][s.gridY]:null,h&&h.open&&h.passable&&(h.cost=e.cost+1,h.open=!1,this._openList.add(h)),h=this.grid[s.gridX+1]?this.grid[s.gridX+1][s.gridY]:null,h&&h.open&&h.passable&&(h.cost=e.cost+1,h.open=!1,this._openList.add(h)),h=this.grid[s.gridX][s.gridY-1]||null,h&&h.open&&h.passable&&(h.cost=e.cost+1,h.open=!1,this._openList.add(h)),h=this.grid[s.gridX][s.gridY+1]||null,h&&h.open&&h.passable&&(h.cost=e.cost+1,h.open=!1,this._openList.add(h));for(t=0;t<this.widthInCells;t++)for(i=0;i<this.heightInCells;i++)o=this.grid[t][i],n=t-1>=0&&this.grid[t-1][i].passable?this.grid[t-1][i].cost:o.cost,a=t+1<this.widthInCells&&this.grid[t+1][i].passable?this.grid[t+1][i].cost:o.cost,o.x=n-a,n=i-1>=0&&this.grid[t][i-1].passable?this.grid[t][i-1].cost:o.cost,a=i+1<this.heightInCells&&this.grid[t][i+1].passable?this.grid[t][i+1].cost:o.cost,o.y=n-a},draw:function(t){var i,e,s,h,o;for(t.lineWidth=1,i=0;i<this.widthInCells;i++)for(e=0;e<this.heightInCells;e++)t.strokeStyle="rgba(0, 0, 0, 0.4)",t.fillStyle="rgba(0, 0, 0, 0.3)",s=this.grid[i][e],s.passable&&(h=i*this.cellPixelSize+.5*this.cellPixelSize,o=e*this.cellPixelSize+.5*this.cellPixelSize,t.beginPath(),t.arc(h,o,3,0,mh.util.TAU,!1),t.fill(),t.moveTo(h,o),t.lineTo(h+11*s.x,o+11*s.y),t.stroke())},getVectorAt:function(t){var i=~~(t.x*this._sizeMulti),e=~~(t.y*this._sizeMulti);return this.grid[i]&&this.grid[i][e]?this.grid[i][e]:null},setBlockAt:function(t,i){return t=~~(t*this._sizeMulti),i=~~(i*this._sizeMulti),this.grid[t][i].passable=!this.grid[t][i].passable,this.grid[t][i].cost=-1,this.build(),!this.grid[t][i].passable},clear:function(){var t,i,e;for(t=0;t<this.widthInCells;t++)for(i=0;i<this.heightInCells;i++)e=this.grid[t][i],e.passable=!0,e.cost=-1;this.build()},toString:function(){var t,i,e="",s=0,h=0;for(t=0;t<this.numCells;t++)i=this.grid[s][h].cost,e+=i>99?i+",":i>9&&100>i?" "+i+",":"  "+i+",",++s===this.widthInCells&&(s=0,h++,e+="\n");return e=e.substring(0,e.length-2)},log:function(){console.log(this.toString())}},mh.FlowGridNode=function(t,i){this.x=0,this.y=0,this.gridX=t,this.gridY=i,this.cost=0,this.open=!0,this.passable=!0,this.uuid=Date.now()+""+Math.floor(1e3*Math.random())},mh.Point=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},mh.Point.prototype={constructor:mh.Point,copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z},clone:function(){return new mh.Point(this.x,this.y,this.z)},toString:function(){return"[Point (x="+this.x+" y="+this.y+" z="+this.z+")]"}},mh.Rectangle=function(t,i,e,s){t=t||0,i=i||0,e=e||0,s=s||0,this.x=t,this.y=i,this.width=e,this.height=s},mh.Rectangle.prototype={constructor:mh.Rectangle,copy:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},clone:function(){return new mh.Rectangle(this.x,this.y,this.width,this.height)},inflate:function(t,i){return this.x-=t,this.width+=2*t,this.y-=i,this.height+=2*i,this},toString:function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")]"}},mh.Scene=function(t,i){var e={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:new THREE.DirectionalLight(16777215),lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},s={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(e=mh.util.merge(e,t),"boolean"!=typeof i&&(s=mh.util.merge(s,i)),this.renderer=new THREE.WebGLRenderer({alpha:e.alpha,antialias:e.antialias}),this.renderer.setClearColor(e.clearColor,0),this.renderer.sortObjects=e.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=e.orthoZoom,this.container=new THREE.Scene,this.container.fog=e.fog,this.container.add(new THREE.AmbientLight(14540253)),e.lightPosition||e.light.position.set(-1,1,-1).normalize(),this.container.add(e.light),"OrthographicCamera"===e.cameraType){var h=window.innerWidth/this.orthoZoom,o=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(h/-2,h/2,o/2,o/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!i,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.minDistance=s.minDistance,this.controls.maxDistance=s.maxDistance,this.controls.zoomSpeed=s.zoomSpeed,this.controls.noZoom=s.noZoom),e.cameraPosition&&this.camera.position.copy(e.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var t=this.width/this.orthoZoom,i=this.height/this.orthoZoom;this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=i/2,this.camera.bottom=i/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(e.element)},mh.Scene.prototype={constructor:mh.Scene,attachTo:function(t){t.style.width=this.width+"px",t.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),t.appendChild(this.renderer.domElement)},add:function(t){this.container.add(t)},remove:function(t){this.container.remove(t)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)return void(this.orthoZoom=0);var t=this.width/this.orthoZoom,i=this.height/this.orthoZoom;this.camera.left=t/-2,this.camera.right=t/2,this.camera.top=i/2,this.camera.bottom=i/-2,this.camera.updateProjectionMatrix()},focusOn:function(t){this.camera.lookAt(t.position)}},mh.TileMap2=function(t,i){this.widthInTiles=Math.floor(mh.kai.width/t)+1,this.heightInTiles=Math.floor(mh.kai.height/t)+1,this.numTiles=this.widthInTiles*this.heightInTiles,this.grid=[],this._blockCache=new mh.LinkedList,this._blockLookup={},this._ctx=null,this._sizeMulti=1/t,this.tileSize=t,this.tilesprite=i},mh.TileMap2.prototype={constuctor:mh.TileMap2,setTile:function(t,i,e){var s,h,o,n,a;return e=e||null,t=~~(t*this._sizeMulti),i=~~(i*this._sizeMulti),s=t*this.heightInTiles+i,0>s||s>=this.numTiles?!1:(n=t*this.tileSize,a=i*this.tileSize,h=this.grid[s],e&&h===e?!1:(h>0?(this.grid[s]=0,this._ctx.clearRect(n,a,this.tileSize,this.tileSize),o=this._blockLookup[n+"-"+a],this._blockCache.add(o),o.disable(),delete this._blockLookup[n+"-"+a]):(this.grid[s]=1,this._ctx.drawImage(this.tilesprite,n,a),this._blockCache.length?(o=this._blockCache.pop(),o.position.x=n+25,o.position.y=a+25):(o=new mh.Block(n+25,a+25),o.collider.setMass(0)),o.enable(),this._blockLookup[n+"-"+a]=o),!0))},getTile:function(t,i){var e;return t=~~(t*this._sizeMulti),i=~~(i*this._sizeMulti),e=t*this.heightInTiles+i,0>e||e>=this.numTiles?null:this.grid[e]},clear:function(){var t;for(var i in this._blockLookup){var e=i.split("-"),s=~~(parseInt(e[0],10)*this._sizeMulti),h=~~(parseInt(e[1],10)*this._sizeMulti),o=s*this.heightInTiles+h;this.grid[o]=0,t=this._blockLookup[i],this._ctx.clearRect(t.position.x-25,t.position.y-25,this.tileSize,this.tileSize),this._blockCache.add(t),t.disable(),delete this._blockLookup[i]}},toString:function(){var t,i,e="",s=0,h=0;for(t=0;t<this.numTiles;t++)i=this.grid[~~(s*this.heightInTiles+h)],e+=i>9&&100>i?i+",":" "+i+",",++s===this.widthInTiles&&(s=0,h++,e+="\n");return e=e.substring(0,e.length-2)}},mh.Vec2=function(t,i){this.x=t||0,this.y=i||0},mh.Vec2.draw=function(t,i,e,s,h,o){h=h||0,o=o||0,t.strokeStyle=s?s:"rgb(250, 10, 10)",t.beginPath(),t.moveTo(i.x+h,i.y+o),t.lineTo(e.x+h,e.y+o),t.stroke()},mh.Vec2.prototype={constructor:mh.Vec2,setLength:function(t){var i=this.getLength();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getLengthSq:function(){return this.x*this.x+this.y*this.y},setAngle:function(t){var i=this.getAngle();return this.x=Math.cos(t)*i,this.y=Math.sin(t)*i,this},getAngle:function(){return Math.atan2(this.y,this.x)},rotateBy:function(t){var i=this.x,e=this.y,s=Math.cos(t),h=Math.sin(t);return this.x=i*s-e*h,this.y=i*h+e*s,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},subtractScalar:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return 0===t.x||0===t.y?this:(this.x/=t.x,this.y/=t.y,this)},divideScalar:function(t){return 0===t?this:(this.x/=t,this.y/=t,this)},perp:function(){var t=-this.y;return this.y=this.x,this.x=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},clamp:function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this},dotProduct:function(t){return this.x*t.x+this.y*t.y},crossProd:function(t){return this.x*t.y-this.y*t.x},truncate:function(t){var i=this.getLength();return 0===i||t>i?this:(this.x/=i,this.y/=i,this.multiplyScalar(t),this)},angleTo:function(t){var i=this.x-t.x,e=this.y-t.y;return Math.atan2(e,i)},distanceTo:function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},normalize:function(){var t=this.getLength();return 0===t?this:(this.x/=t,this.y/=t,this)},set:function(t,i){return t=t?t:0,i=i?i:0,this.x=t,this.y=i,this},equals:function(t){return this.x===t.x&&this.y===t.y?!0:!1},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new mh.Vec2(this.x,this.y)},draw:function(t,i,e,s){i=i?i:0,e=e?e:0,s=s?s:"rgb(0, 250, 0)",t.strokeStyle=s,t.beginPath(),t.moveTo(i,e),t.lineTo(this.x,this.y),t.stroke()},toString:function(){return"["+this.x+", "+this.y+"]"}},mh.VectorFieldState=function(t){this.uuid=mh.util.generateID(),this.fieldID=-1,this.reachedGoal=!0,mh.kai.addComponent(t,mh.Component.FLOCK,mh.Flock);var i=t.position,e=mh.kai.flow,s=12,h=Math.ceil(Math.random()*s);this.update=function(){var o;if(h--,0>h&&!this.reachedGoal)if(h=s,i.distanceTo(mh.kai.flow.goalPixels)<100)this.reachedGoal=!0;else for(o=t.flock.nearby.first;o;)if(o.obj.vecFieldState){if(o.obj.vecFieldState.reachedGoal){this.reachedGoal=!0;break}o=o.next}else o=o.next;return e.getVectorAt(i,this.fieldID)},this.destroy=function(){e=null,i=null,t=null}},mh.steering={_sumForce:new mh.Vec2,_desiredVec:new mh.Vec2,_scratchVec:new mh.Vec2,_wanderVec:new mh.Vec2,_seperationForce:new mh.Vec2,_cohereForce:new mh.Vec2,_alignForce:new mh.Vec2,_wanderAngle:0,seek:function(t,i,e){var s=t.position.distanceTo(i);return e=e||0,7>s?void t.velocity.multiplyScalar(.9):(this._desiredVec.copy(i).subtract(t.position),this._desiredVec.normalize(),e>s?(this._desiredVec.multiplyScalar(t.maxForce*(s/e)),t.velocity.multiplyScalar(.9)):this._desiredVec.multiplyScalar(t.maxForce),void t.steeringForce.add(this._desiredVec))},flee:function(t,i){this._desiredVec.copy(t.position).subtract(i),this._desiredVec.normalize().multiplyScalar(t.maxForce),t.steeringForce.add(this._desiredVec)},align:function(t,i){var e,s,h=0,o=i.first;for(this._alignForce.x=0,this._alignForce.y=0;o;)e=o.obj.entity.boid,e.groupID===t.groupID?(s=t.position.distanceTo(e.position),s<t.maxCohesion&&e.velocity.getLength()>0&&(this._scratchVec.copy(e.velocity),this._scratchVec.normalize(),this._alignForce.add(this._scratchVec),e._arrived&&(t._arrived=!0),h++),o=o.next):o=o.next;return 0===h?this._alignForce:(this._alignForce.divideScalar(h),this._alignForce.multiplyScalar(t.maxForce),this._alignForce)},cohere:function(t,i){var e,s,h=0,o=i.first;for(this._sumForce.x=0,this._sumForce.y=0;o;)e=o.obj.entity.boid,e!==t&&e.groupID===t.groupID&&(s=t.position.distanceTo(e.position),s<t.maxCohesion&&(this._sumForce.add(e.position),e._arrived&&(t._arrived=!0),h++)),o=o.next;return 0===h?(this._cohereForce.x=0,void(this._cohereForce.y=0)):(this._sumForce.divideScalar(h),this._cohereForce.copy(this._sumForce).subtract(t.position),this._cohereForce.normalize().multiplyScalar(t.maxForce),this._cohereForce)},separate:function(t,i){var e=0,s=i.first;for(this._seperationForce.x=0,this._seperationForce.y=0;s;){var h=s.obj.entity.boid;if(h!==t){var o=t.position.distanceTo(h.position);if(o<t.minSeparation&&o>0){this._scratchVec.copy(h.position).subtract(t.position);var n=this._scratchVec.getLength(),a=t.minSeparation+h.minSeparation;this._scratchVec.multiplyScalar(1-(n-a)/(t.minSeparation-a)),this._seperationForce.x+=this._scratchVec.x,this._seperationForce.y+=this._scratchVec.y,e++}}s=s.next}return 0===e?this._seperationForce:(this._seperationForce.multiplyScalar(t.maxForce/e),this._seperationForce)},wander:function(t){this._desiredVec.copy(t.velocity),this._desiredVec.normalize(),this._desiredVec.multiplyScalar(t.targetDistance),this._scratchVec.reset(0,-1),this._scratchVec.multiplyScalar(t.targetRadius),this._scratchVec.setAngle(t._wanderAngle),t._wanderAngle+=Math.random()*t.angleJitter-.5*t.angleJitter,this._desiredVec.add(this._scratchVec),t.steeringForce.add(this._desiredVec)},flock:function(t,i){this.separate(t,i),this.align(t,i),this.cohere(t,i),this._seperationForce.multiplyScalar(.2),this._alignForce.multiplyScalar(1.3),this._cohereForce.multiplyScalar(.6),t.steeringForce.x+=this._seperationForce.x+this._alignForce.x+this._cohereForce.x,t.steeringForce.y+=this._seperationForce.y+this._alignForce.y+this._cohereForce.y},followPath:function(t,i,e){var s=i[t._currentPathNode];(t._arrived||t.position.distanceTo(s)<=t.pathArriveRadius)&&(t._currentPathNode+=t._pathDir,t._arrived=!1,(t._currentPathNode>=i.length||t._currentPathNode<0)&&(e?(t._pathDir*=-1,t._currentPathNode+=t._pathDir):(t._currentPathNode=i.length-1,s=i[t._currentPathNode],t._arrived=!0))),this.seek(t,s,t.slowingRadius)},pursue:function(t,i){this._scratchVec.copy(i.position).add(i.velocity),this._scratchVec.multiplyScalar(t.distanceTo(i)/t.maxForce),this.seek(t,this._scratchVec)},evade:function(t,i){this._scratchVec.copy(i.position).add(i.velocity),this._scratchVec.multiplyScalar(t.distanceTo(i)/t.maxForce),this.flee(t,this._scratchVec)}},mh.GridTargeter=function(t,i){i=i||{},mh.Base.call(this),this.searchInterval=1e3,this.scanRadius=400,this.collisionId=t.collisionId,this.target=null,mh.util.overwrite(this,i),this.entity=t,this._nearby=new mh.LinkedList,this._grid=mh.world.broadphase,this._timer=0,this.position=t.position},mh.GridTargeter.accessor="gridTargeter",mh.GridTargeter.className="GRID_TARGETER",mh.GridTargeter.priority=10,mh.GridTargeter.prototype={constructor:mh.GridTargeter,activate:function(){this.active=!0,this.target=null,this.collisionId=this.entity.collisionId,this._findTarget()},disable:function(){this.active=!1,this.target=null},update:function(){performance.now()-this._timer>=this.searchInterval&&(this._findTarget(),this._timer=performance.now())},dispose:function(){this.entity=null,this.position=null},_findTarget:function(){var t,i;for(this._nearby.clear(),this._grid.getNearby(this.position,this.scanRadius,this._nearby),t=this._nearby.first;t;){if(i=t.obj,i&&i.entity.id!==this.entity.id)return void(this.target=i);t=t.next}this.target=null}},mh.Health=function(t,i){i=i||{},mh.Base.call(this),this.max=100,this.overage=0,this.alive=!1,this.active=!1,mh.util.overwrite(this,i),this.onDeath=new mh.Signal,this.onDamage=new mh.Signal,this.onHeal=new mh.Signal,this.onFull=new mh.Signal,this.onActivate=new mh.Signal,this.entity=t,this._meter=0},mh.Health.accessor="health",mh.Health.className="HEALTH",mh.Health.priority=1,mh.Health.prototype={constructor:mh.Health,activate:function(){this._meter=this.max,this.alive=!0,this.onActivate.dispatch(this._meter,this.entity)},change:function(t){return this.alive?(this._meter+=t,this._meter<=0?(this._meter=0,this.alive=!1,this.onDeath.dispatch(t,this.entity)):(this._meter>this.max+this.overage&&(this._meter=this.max,this.onFull.dispatch(t)),0>t?this.onDamage.dispatch(t):this.onHeal.dispatch(t)),this._meter):0},drain:function(t){return this.alive?(this._meter>this.max&&(this._meter-=t,this._meter<=this.max&&(this._meter=this.max,this.onFull.dispatch(t))),this._meter):0},dispose:function(){this.onDeath.dispose(),this.onDamage.dispose(),this.onHeal.dispose(),this.onFull.dispose(),this.entity=null,this.deathSignal=null,this.onDamage=null,this.onHeal=null,this.onFull=null}},mh.Timer=function(t,i){i=i||{},mh.Base.call(this),this.repeat=-1,this.immediateDispatch=!1,this.interval=1e3,mh.util.overwrite(this,i),this.onInterval=new mh.Signal,this.entity=t,this._timer=0,this._numTicks=0,this._currentRepeat=this.repeat,this.disable()},mh.Timer.accessor="timer",mh.Timer.className="TIMER",mh.Timer.priority=13,mh.Timer.prototype={constructor:mh.Timer,activate:function(){this._timer=performance.now(),this.active=!0,this._currentRepeat=this.repeat,this._numTicks=0,this.immediateDispatch&&(this._numTicks++,this.onInterval.dispatch(this._numTicks))},disable:function(){this.active=!1},reset:function(){this._timer=performance.now(),this._numTicks=0,this.active&&this.immediateDispatch&&(this._numTicks++,this.onInterval.dispatch(this._numTicks))},update:function(){if(performance.now()-this._timer>=this.interval){if(this._numTicks++,this.onInterval.dispatch(this._numTicks),-1!==this.repeat&&0===this._currentRepeat--)return void this.disable();this._timer=performance.now()}},dispose:function(){this.onInterval.dispose(),this.onInterval=null,this.entity=null}},mh.BoidGroup=function(t){t=t||{},mh.Base.call(this),this.maxForce=9999999,this.slowingRadius=70,this.pathArriveRadius=60,this.groupID=this.uuid,this.repeat=!1,mh.util.overwrite(this,t),this.members=new mh.LinkedList,this.steeringForce=new mh.Vec2,this._currentPathNode=0,this._pathDir=1,this._arrived=!0,this._nodePool=new mh.DualPool(mh.Vec2,null,5),this.position=new mh.Vec2,this.velocity=new mh.Vec2,this.path=[],mh.kai.addComponent(this,mh.Component.STACK_FSM),this.onComplete=new mh.Signal,this.stackFSM.stateChanged.add(this._stateChanged,this)},mh.BoidGroup.DETACHED=0,mh.BoidGroup.ATTACHED=1,mh.BoidGroup.prototype={constructor:mh.BoidGroup,addBoid:function(t){t.groupID=this.groupID,this.members.add(t),t.maxForce<this.maxForce&&(this.maxForce=t.maxForce)},addEntity:function(t){return t.boid?void this.addBoid(t.boid):void console.warn("[BoidGroup.addEntity] All entities added to BoidGroup must have boid components")},addEntities:function(t){for(var i,e=t.first;e;)i=e.obj,i.boid&&(this.addBoid(i.boid),e=e.next)},removeBoid:function(t){var i;if(this.members.remove(t),this.maxForce=9999999,0===this.members.length)return this.disable(),void this.onComplete.dispatch(this);for(i=this.members.first;i;)t.maxForce<this.maxForce&&(this.maxForce=t.maxForce),i=i.next},removeEntity:function(t){this.removeBoid(t.boid)},removeAll:function(){this.members.clear(),this.disable(),this.onComplete.dispatch(this)},addWaypoint:function(t,i){var e=this._nodePool.get();e.x=t,e.y=i,this.path.push(e),this._arrived=!1,this.stackFSM.pushState(this.followPath,this)},setPath:function(t){var i,e;for(this._nodePool.freeAll(),this.path.length=0,i=0;i<t.length;i++)e=t[i],this.addWaypoint(e.x,e.y);this.stackFSM.pushState(this.followPath,this)},activate:function(t){var i,e;if(!this.active){for(this.active=!0,this.stackFSM.activate(),t&&(this.members.clear(),this.addEntities(t)),e=this.members.first;e;)i=e.obj,this.position.add(i.position),e=e.next;this.position.divideScalar(this.members.length)}},disable:function(){this.active=!1,this.reset(),this.stackFSM.disable()},reset:function(){this.velocity.x=0,this.velocity.y=0,this._nodePool.freeAll(),this.path.length=0,this._currentPathNode=0,this._pathDir=1,this._arrived=!0},dispose:function(){mh.kai.removeComponent(this,mh.Component.STACK_FSM),this.members.dispose(),this.members=null,this._nodePool.dispose(),this._nodePool=null,this.steeringForce=null,this.position=null,this.velocity=null,this.path=null},followPath:function(){var t,i=this.members.first;for(mh.Steering.followPath(this,this.path,this.repeat),this.position.x=0,this.position.y=0;i;)t=i.obj,t.groupID===this.groupID?(mh.Steering.flock(t,this.members),this.position.add(t.position),t.velocity.add(this.steeringForce),i=i.next):(this.removeBoid(t),i=i.next);this.position.divideScalar(this.members.length),this.steeringForce.x=0,this.steeringForce.y=0,this._arrived&&this.stackFSM.popState()},_stateChanged:function(t,i){var e,s,h=this.members.first;if(t!==i)switch(i){case"followPath":for(this.activate(),this._currentPathNode=0,this._pathDir=1,this._arrived=!1,e=this.path[this._currentPathNode],this.velocity.copy(e),this.velocity.normalize().multiplyScalar(this.maxForce);h;)s=h.obj,s.groupControl.dispatch(mh.BoidGroup.ATTACHED),h=h.next;break;default:for(this.disable();h;)s=h.obj,s.groupControl.dispatch(mh.BoidGroup.DETACHED),h=h.next;this.onComplete.dispatch(this)}}},mh.Boid=function(t,i){i=i||{},mh.Base.call(this),this.maxForce=10,this.slowingRadius=50,this.pathArriveRadius=50,this.groupID=0,this.flockRadius=160,this.maxCohesion=140,this.minSeparation=70,this.angleJitter=.9,this.targetDistance=20,this.targetRadius=20,mh.util.overwrite(this,i),this.entity=t,this.steeringForce=new mh.Vec2(mh.util.random(this.maxForce),mh.util.random(this.maxForce)),this.maxSpeed=this.entity.maxSpeed||this.maxForce,t.body&&(this.maxSpeed=t.body.maxSpeed),this._wanderAngle=0,this._currentPathNode=0,this._pathDir=1,this._arrived=!1,this.position=mh.kai.expect(t,"position",mh.Vec2),this.rotation=mh.kai.expect(t,"rotation",mh.Vec2),this.velocity=mh.kai.expect(t,"velocity",mh.Vec2),this.groupControl=new mh.Signal},mh.Boid.accessor="boid",mh.Boid.className="BOID",mh.Boid.priority=95,mh.Boid.post=!1,mh.Boid.prototype={constructor:mh.Boid,activate:function(){this.active=!0,this._currentPathNode=0,this._pathDir=1,this._arrived=!1;
},disable:function(){this.active=!1},update:function(){this.steeringForce.truncate(this.maxForce),this.steeringForce.multiplyScalar(this.entity.body.invmass),this.velocity.x+=this.steeringForce.x,this.velocity.y+=this.steeringForce.y,this.rotation.x=this.velocity.x,this.rotation.y=this.velocity.y,this.steeringForce.x=0,this.steeringForce.y=0},dispose:function(){this.groupControl.dispose(),this.groupControl=null,this.entity=null,this.steeringForce=null,this.position=null,this.rotation=null,this.velocity=null}};var StackFSM=function(t){mh.Base.call(this),this.state=null,this.stack=[],this.entity=t,this.stateChanged=new mh.Signal,this._activeContext=null,this._activeFunction=null,this._prevFunction=null};StackFSM.accessor="stackFSM",StackFSM.className="STACK_FSM",StackFSM.priority=5,StackFSM.post=!1,StackFSM.prototype={constructor:StackFSM,activate:function(){this.active=!0},disable:function(){this.active=!1,this.reset()},reset:function(){this.stack.length=0,this._prevFunction=null,this._activeFunction=null},pushState:function(t,i){t!==this._activeFunction&&(this.stack.push(t),this._activeContext=i,this.active||this.activate())},popState:function(){this.stack.pop(),this._activeFunction=this.stack.length?this.stack[this.stack.length-1]:null,this._activeFunction||(this.stateChanged.dispatch(this.state,"null"),this._prevFunction=null,this.disable())},update:function(){this._activeFunction=this.stack.length?this.stack[this.stack.length-1]:null,this._activeFunction&&(this._activeFunction!==this._prevFunction&&(this.state=this._activeFunction.name,this.stateChanged.dispatch(this._prevFunction?this._prevFunction.name:"null",this.state),this._prevFunction=this._activeFunction),this._activeFunction.call(this._activeContext))},dispose:function(){this.entity=null,this._activeFunction=null,this._prevFunction=null,this.stack=null,this.stateChanged.dispose(),this.stateChanged=null}},mh.PIXISprite=function(t,i){i=i||{},mh.Base.call(this),this.textureUrl="img/square-outline-textured.png",this.container=mh.kai.view,mh.util.overwrite(this,i),this.entity=t,this._display=null,this.position=t.position},mh.PIXISprite.accessor="view",mh.PIXISprite.className="VIEW_SPRITE",mh.PIXISprite.priority=10,mh.PIXISprite.prototype={constructor:mh.PIXISprite,activate:function(){this.active=!0},disable:function(){this.active=!1},update:function(){},dispose:function(){this.disable(),this.entity=null,this.position=null}},mh.THREECube=function(t,i){i=i||{},mh.Base.call(this),this.textureUrl="img/square-outline-textured.png",this.container=mh.kai.view,this.size=50,this.dynamic=!1,this.color=16693068,mh.util.overwrite(this,i),this.entity=t,this._display=null;var e=new THREE.CubeGeometry(this.size,this.size,this.size),s=new THREE.MeshLambertMaterial({color:this.color,ambient:this.color,shading:THREE.FlatShading,map:this.dynamic?null:THREE.ImageUtils.loadTexture(this.textureUrl)});this._display=new THREE.Mesh(e,s),this.dynamic||(this._display.matrixAutoUpdate=!1,this._display.position.copy(t.position),this._display.updateMatrix()),this.position=t.position},mh.THREECube.accessor="view",mh.THREECube.className="VIEW_CUBE",mh.THREECube.priority=10,mh.THREECube.prototype={constructor:mh.THREECube,activate:function(){this.active=!0,this.container.add(this._display)},disable:function(){this.active=!1,this.container.remove(this._display)},update:function(){this._display.position.x=this.position.x,this._display.position.y=this.position.y,this._display.position.z=this.position.z},dispose:function(){this.disable(),this.entity=null,this.position=null,this._display=null}},mh.GamepadController=function(){this.controllers=[],this.onConnect=new mh.Signal,this.onDisconnect=new mh.Signal,this.activeControllers=0,this._controllerStatus=[];for(var t=0;4>t;t++)this.controllers[t]=new mh.XboxGamepad(t),this._controllerStatus[t]=!1;window.addEventListener("gamepadconnected",this._onConnect.bind(this),!1),window.addEventListener("gamepaddisconnected",this._onDisconnect.bind(this),!1)},mh.GamepadController.prototype={constructor:mh.GamepadController,update:function(){var t,i;for(navigator.webkitGetGamepads&&this._scan(),t=0;4>t;t++)i=this.controllers[t],i.active&&i.update()},dispose:function(){this.controllers=null,this.onConnect.dispose(),this.onDisconnect.dispose(),this.onConnect=null,this.onDisconnect=null,this._controllerStatus=null},_addPad:function(t){var i=this.controllers[t.index];i.register(t),i.activate(),this.onConnect.dispatch(i),this.activeControllers++},_removePad:function(t){var i=t.index?this.controllers[t.index]:this.controllers[t];i.unregister(),this.onDisconnect.dispatch(i),this.activeControllers--},_onConnect:function(t){this._addPad(t.gamepad)},_onDisconnect:function(t){this._removePad(t.gamepad)},_scan:function(){var t,i=navigator.webkitGetGamepads();for(t=0;t<i.length;t++)i[t]?this._controllerStatus[t]?this.controllers[t].setPad(i[t]):(this._addPad(i[t]),this._controllerStatus[t]=!0):!i[t]&&this._controllerStatus[t]&&(this._removePad(t),this._controllerStatus[t]=!1)}},mh.KeyboardController=function(){this.key=-1,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.shift=!1,this.ctrl=!1,this._keys={},this._prev=null,document.addEventListener("keydown",this._processDown.bind(this),!1),document.addEventListener("keyup",this._processUp.bind(this),!1)},mh.KeyboardController.prototype={constructor:mh.KeyboardController,_processDown:function(t){var i=this._keys[t.keyCode];return mh.kai.inputBlocked||this.key===this._prev?void t.preventDefault():(this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey,this.key=t.keyCode,i&&i.isDown?this._keys[t.keyCode].duration=performance.now()-i.timeDown:i?(this._keys[t.keyCode].isDown=!0,this._keys[t.keyCode].timeDown=performance.now(),this._keys[t.keyCode].duration=0):this._keys[t.keyCode]={isDown:!0,timeDown:performance.now(),timeUp:0,duration:0},this.onDown.dispatch(this.key),void(this._prev=this.key))},_processUp:function(t){return mh.kai.inputBlocked?void t.preventDefault():(this.key=-1,this.shift=!1,this.ctrl=!1,this._keys[t.keyCode]?(this._keys[t.keyCode].isDown=!1,this._keys[t.keyCode].timeUp=performance.now()):this._keys[t.keyCode]={isDown:!1,timeDown:performance.now(),timeUp:performance.now(),duration:0},void this.onUp.dispatch(t.keyCode,this._keys[t.keyCode].timeUp-this._keys[t.keyCode].timeDown))},activate:function(){for(var t in this._keys)this._keys[t].isDown=!1},justPressed:function(t,i){return"undefined"==typeof i&&(i=100),this._keys[t]&&this._keys[t].isDown&&this._keys[t].duration<i?!0:!1},justReleased:function(t,i){return"undefined"==typeof i&&(i=100),this._keys[t]&&this._keys[t].isDown===!1&&performance.now()-this._keys[t].timeUp<i?!0:!1},isDown:function(t){return this._keys[t]?this._keys[t].isDown:!1},A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,UNDERSCORE:189,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},mh.MouseController=function(){this.position=new mh.Vec2,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.down=!1,this.shift=!1,this.ctrl=!1,document.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mouseout",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("contextmenu",this.onMouseContext,!1)},mh.MouseController.prototype={constructor:mh.MouseController,onMouseDown:function(t){return mh.kai.inputBlocked?void t.preventDefault():(this.position.x=t.pageX,this.position.y=t.pageY,this.down=!0,this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey,void this.onDown.dispatch(this.position))},onMouseUp:function(t){return!this.down||mh.kai.inputBlocked?void t.preventDefault():(this.position.x=t.pageX,this.position.y=t.pageY,this.down=!1,this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey,void this.onUp.dispatch(this.position))},onMouseMove:function(t){t.preventDefault(),this.position.x=t.pageX,this.position.y=t.pageY,this.shift=!!t.shiftKey,this.ctrl=!!t.ctrlKey},onMouseContext:function(t){return t.preventDefault(),!1}},mh.TwinStickMovement=function(t,i){i=i||{},mh.Base.call(this),this.speed=1,this.pad=null,mh.util.overwrite(this,i),this.entity=t,this.accel=t.accel,this.rotation=t.rotation,this.active=!1},mh.TwinStickMovement.accessor="input",mh.TwinStickMovement.className="INPUT_TWINSTICK",mh.TwinStickMovement.priority=20,mh.TwinStickMovement.prototype={constructor:mh.TwinStickMovement,activate:function(){this.accel.x=this.accel.y=0,this.rotation.x=this.rotation.y=0,this.active=!0},disable:function(){this.active=!1},update:function(){this.accel.copy(this.pad.leftAxis).multiplyScalar(this.speed),this.rotation.copy(this.pad.rightAxis)},dispose:function(){this.entity=null,this.accel=null,this.rotation=null}},mh.XboxGamepad=function(t){mh.Base.call(this),this.id=t,this.onDown=new mh.Signal,this.onUp=new mh.Signal,this.leftAxis=new mh.Vec2,this.rightAxis=new mh.Vec2,this.leftTrigger=0,this.rightTrigger=0,this.axisTolerance=.2,this.controller=null,this.buttons=null,this._numButtons=0,this._mozAxisOffset=0,this._prevButtons=[]},mh.XboxGamepad.prototype={constructor:mh.XboxGamepad,register:function(t){this.setPad(t),this._numButtons=this.buttons.length,navigator.webkitGetGamepads?this._mozAxisOffset=0:this._mozAxisOffset=1,this.activate()},setPad:function(t){this.controller=t,this.buttons=t.buttons},unregister:function(){this.controller=null,this.buttons=null,this._numButtons=0},update:function(){var t,i,e=this.controller.axes[0],s=this.controller.axes[1],h=this.controller.axes[2+this._mozAxisOffset],o=this.controller.axes[3+this._mozAxisOffset];for(e<this.axisTolerance&&e>-this.axisTolerance&&(e=0),s<this.axisTolerance&&s>-this.axisTolerance&&(s=0),h<this.axisTolerance&&h>-this.axisTolerance&&(h=0),o<this.axisTolerance&&o>-this.axisTolerance&&(o=0),this.leftAxis.x=e,this.leftAxis.y=s,this.rightAxis.x=h,this.rightAxis.y=o,t=0;t<this._numButtons;t++)i=this.buttons[t],6===t?this.leftTrigger=i.value||i:7===t&&(this.rightTrigger=i.value||i),i&&!this._prevButtons[t]?this.onDown.dispatch(t,i):!i&&this._prevButtons[t]&&this.onUp.dispatch(t,i),this._prevButtons[t]=i},isDown:function(t){return mh.kai.inputBlocked||!this.active?!1:!!this.buttons[t]},activate:function(){this.active=!0,this.leftAxis.x=0,this.leftAxis.y=0,this.rightAxis.x=0,this.rightAxis.y=0,this.leftTrigger=0,this.rightTrigger=0;for(var t=0;t<this._numButtons;t++)this.buttons[t]=0,this._prevButtons[t]=0},disable:function(){this.active=!1},dispose:function(){this.onDown.dispose(),this.onUp.dispose(),this.onDown=null,this.onUp=null}},mh.XBOX={A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,SELECT:8,START:9,LSTICK:10,RSTICK:11,UP:12,DOWN:13,LEFT:14,RIGHT:15},mh.CollisionGridScanner=function(t,i){i=i||{},mh.Base.call(this),this.scanRadius=1,mh.util.overwrite(this,i),this.onCollision=new mh.Signal,this.entity=t,this._body=t.body,this._nearby=new mh.LinkedList,this._grid=mh.world.broadphase},mh.CollisionGridScanner.accessor="collisionScanner",mh.CollisionGridScanner.className="COLLISION_SCANNER_RADIAL",mh.CollisionGridScanner.priority=5,mh.CollisionGridScanner.prototype={constructor:mh.CollisionGridScanner,activate:function(){this.active=!0},disable:function(){this.active=!1},update:function(){var t,i;for(this._grid.getNeighbors(this._body,this.scanRadius,this._nearby),t=this._nearby.first;t;){if(i=t.obj,mh.physics.testCircleVsCircle(i,this._body)){this.onCollision.dispatch(i);break}t=t.next}},dispose:function(){this.onCollision.dispose(),this.entity=null,this.position=null,this.onCollision=null}};
//# sourceMappingURL=motorhaus-extras.min.js.map
