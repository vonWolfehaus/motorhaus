var von2d={};von2d.Rectangle=function(){var t=function(t,i,s,e){this.x=t||0,this.y=i||0,this.width=s||0,this.height=e||0};return t.prototype.copy=function(t){t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;var s=this.x;if(t>=s&&t<=s+this.width){var e=this.y;if(i>=e&&i<=e+this.height)return!0}return!1},t.prototype.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},t}({}),von2d.GS=function(t,i){var i=von2d.Rectangle,s={blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},blendModesCanvas:[],scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},EmptyRectangle:new i};return s}({},von2d.Rectangle),von2d.Point=function(){var t=function(t,i){this.x=t||0,this.y=i||0};return t.prototype.copy=function(t){t.x=this.x,t.y=this.y},t.prototype.reset=function(t,i){this.x=t||0,this.y=i||(0!==i?this.x:0)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},t}({}),von2d.Matrix2=function(){var t=function(t,i,s,e,n,r){return this.a=t?t:1,this.b=i||0,this.c=s||0,this.d=e?e:1,this.tx=n||0,this.ty=r||0,this};return t.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),e=this.a,n=this.c,r=this.tx;return this.a=e*i-this.b*s,this.b=e*s+this.b*i,this.c=n*i-this.d*s,this.d=n*s+this.d*i,this.tx=r*i-this.ty*s,this.ty=r*s+this.ty*i,this},t.prototype.skew=function(t,i){return this.append(Math.cos(i),Math.sin(i),-Math.sin(t),Math.cos(t),0,0),this},t.prototype.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},t.prototype.translate=function(t,i){return this.tx+=t,this.ty+=i,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.toArray=function(t){return this.array||(this.array=new Float32Array(9)),t?(this.array[0]=this.a,this.array[1]=this.c,this.array[2]=0,this.array[3]=this.b,this.array[4]=this.d,this.array[5]=0,this.array[6]=this.tx,this.array[7]=this.ty,this.array[8]=1):(this.array[0]=this.a,this.array[1]=this.b,this.array[2]=this.tx,this.array[3]=this.c,this.array[4]=this.d,this.array[5]=this.ty,this.array[6]=0,this.array[7]=0,this.array[8]=1),this.array},t.prototype.copy=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.clone=function(){return(new t).copy(this)},t.prototype.toString=function(){return"[Matrix2 (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t}({}),von2d.DisplayObject=function(t,i,s,e){var i=von2d.GS,s=von2d.Point,e=von2d.Rectangle,n=von2d.Matrix2,r=function(){this.uniqueId=Math.random().toString(36).slice(2)+Date.now(),this.position=new s,this.scale=new s(1,1),this.pivot=new s,this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this.worldTransform=new n,this._sr=0,this._cr=1,this._bounds=new e(0,0,1,1),this._currentBounds=null,this._parentTransform=null,this._a00=0,this._a01=0,this._a10=0,this._a11=0,this._a02=0,this._a12=0,this._b00=0,this._b10=0};return Object.defineProperty(r.prototype,"worldVisible",{get:function(){for(var t=this;t;){if(!t.visible)return!1;t=t.parent}return!0}}),r.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),this._parentTransform=this.parent.worldTransform,this._a00=this._cr*this.scale.x,this._a01=-this._sr*this.scale.y,this._a10=this._sr*this.scale.x,this._a11=this._cr*this.scale.y,this._a02=this.position.x-this._a00*this.pivot.x-this.pivot.y*this._a01,this._a12=this.position.y-this._a11*this.pivot.y-this.pivot.x*this._a10,this._b00=this._parentTransform.a,this._b01=this._parentTransform.b,this._b10=this._parentTransform.c,this._b11=this._parentTransform.d,this.worldTransform.a=this._b00*this._a00+this._b01*this._a10,this.worldTransform.b=this._b00*this._a01+this._b01*this._a11,this.worldTransform.tx=this._b00*this._a02+this._b01*this._a12+this._parentTransform.tx,this.worldTransform.c=this._b10*this._a00+this._b11*this._a10,this.worldTransform.d=this._b10*this._a01+this._b11*this._a11,this.worldTransform.ty=this._b10*this._a02+this._b11*this._a12+this._parentTransform.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},r.prototype.getBounds=function(t){return t=t,i.EmptyRectangle},r.prototype.setStageReference=function(t){this.stage=t},r.prototype.draw=function(t){t=t},Object.defineProperty(r.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(r.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),r}({},von2d.GS,von2d.Point,von2d.Rectangle,von2d.Matrix2),von2d.Sprite=function(t,i,s,e,n){var i=von2d.GS,s=von2d.DisplayObject,e=von2d.Point,n=von2d.Rectangle,r=function(t,r){s.call(this),this.anchor=new e(.5,.5),this.texture=t,this._width=r?r.width:t.width,this._height=r?r.height:t.height,this.frame=r||new n(0,0,t.width,t.height),this.scale.x=this._width/this.frame.width,this.scale.y=this._height/this.frame.height,this.blendMode=i.blendModes.NORMAL,this.renderable=!0};return r.prototype=Object.create(s.prototype),r.prototype.constructor=r,Object.defineProperty(r.prototype,"width",{get:function(){return this.scale.x*this.frame.width},set:function(t){this.scale.x=t/this.frame.width,this._width=t}}),Object.defineProperty(r.prototype,"height",{get:function(){return this.scale.y*this.frame.height},set:function(t){this.scale.y=t/this.frame.height,this._height=t}}),r.prototype.getBounds=function(t){var i=this.frame.width,s=this.frame.height,e=i*(1-this.anchor.x),n=i*-this.anchor.x,r=s*(1-this.anchor.y),h=s*-this.anchor.y,o=t||this.worldTransform,a=o.a,d=o.c,l=o.b,c=o.d,u=o.tx,p=o.ty,f=a*n+l*h+u,v=c*h+d*n+p,y=a*e+l*h+u,b=c*h+d*e+p,x=a*e+l*r+u,g=c*r+d*e+p,_=a*n+l*r+u,w=c*r+d*n+p,m=-1/0,M=-1/0,T=1/0,C=1/0;T=T>f?f:T,T=T>y?y:T,T=T>x?x:T,T=T>_?_:T,C=C>v?v:C,C=C>b?b:C,C=C>g?g:C,C=C>w?w:C,m=f>m?f:m,m=y>m?y:m,m=x>m?x:m,m=_>m?_:m,M=v>M?v:M,M=b>M?b:M,M=g>M?g:M,M=w>M?w:M;var j=this._bounds;return j.x=T,j.width=m-T,j.y=C,j.height=M-C,this._currentBounds=j,j},r.prototype.draw=function(t){t.globalAlpha=this.worldAlpha,t.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty),t.drawImage(this.texture,this.frame.x,this.frame.y,this.frame.width,this.frame.height,this.anchor.x*-this.frame.width,this.anchor.y*-this.frame.height,this.frame.width,this.frame.height)},r}({},von2d.GS,von2d.DisplayObject,von2d.Point,von2d.Rectangle),von2d.LinkedList=function(){var t=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0};window.LinkedListNode=t;var i=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueId=Date.now()+""+Math.floor(1e3*Math.random()),this.getNode=function(t){return this.objToNodeMap[t.uniqueId]},this.addNode=function(i){var s=new t;return s.obj=i,s.prev=null,s.next=null,s.free=!1,this.objToNodeMap[i.uniqueId]=s,s},this.add=function(t){var i=this.objToNodeMap[t.uniqueId];if(i){if(i.free===!1)return;i.obj=t,i.free=!1,i.next=null,i.prev=null}else i=this.addNode(t);if(this.first){if(null==this.last)throw new Error("Hmm, no last in the list -- that shouldn't happen here");this.last.next=i,i.prev=this.last,this.last=i,i.next=null}else this.first=i,this.last=i,i.next=null,i.prev=null;this.length++,this.showDebug&&this.dump("after add")},this.has=function(t){return!!this.objToNodeMap[t.uniqueId]},this.moveUp=function(t){this.dump("before move up");var i=this.getNode(t);if(!i)throw"Oops, trying to move an object that isn't in the list";if(null!=i.prev){var s=i.prev,e=s.prev;i==this.last&&(this.last=s);var n=i.next;e&&(e.next=i),i.next=s,i.prev=s.prev,s.next=n,s.prev=i,this.first==s&&(this.first=i)}},this.moveDown=function(t){var i=this.getNode(t);if(!i)throw"Oops, trying to move an object that isn't in the list";if(null!=i.next){var s=i.next;this.moveUp(s.obj),this.last==s&&(this.last=i)}},this.sort=function(t){for(var i,s,e=[],n=this.first;n;)e.push(n.object()),n=n.next();for(this.clear(),e.sort(t),s=e.length,i=0;s>i;i++)this.add(e[i])},this.remove=function(t){var i=this.getNode(t);return null==i||1==i.free?!1:(null!=i.prev&&(i.prev.next=i.next),null!=i.next&&(i.next.prev=i.prev),null==i.prev&&(this.first=i.next),null==i.next&&(this.last=i.prev),i.free=!0,i.prev=null,i.next=null,this.length--,!0)},this.shift=function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.pop=function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.clear=function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},this.dispose=function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},this.dump=function(t){console.log("===================="+t+"=====================");for(var i=this.first;null!=i;)console.log("{"+i.obj.toString()+"} previous="+(i.prev?i.prev.obj:"NULL")),i=i.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}};return window.LinkedList=i,i}(),von2d.Container=function(t,i,s,e){var i=von2d.GS,s=von2d.DisplayObject,e=von2d.LinkedList;return Container=function(){s.call(this),this.children=new e,this._scratch=null},Container.prototype=Object.create(s.prototype),Container.prototype.constructor=Container,Container.prototype.addChild=function(t){var i,s=arguments.length;if(s>1){for(i=0;s>i;i++)this.addChild(arguments[i]);return arguments[s-1]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.stage&&t.setStageReference(this.stage),this.children.add(t),t},Container.prototype.removeChild=function(t){return t.parent=null,this.stage&&(t.stage=null),this.children.remove(t)},Container.prototype.contains=function(t){for(;t;){if(t===this)return!0;t=t.parent}return!1},Container.prototype.updateTransform=function(){if(this.visible)for(s.prototype.updateTransform.call(this),this._scratch=this.children.first;this._scratch;)this._scratch.obj.updateTransform(),this._scratch=this._scratch.next},Container.prototype.getBounds=function(t){var s;if(0===this.children.length)return i.EmptyRectangle;if(t){var e=this.worldTransform;this.worldTransform=t,this.updateTransform(),this.worldTransform=e}var n,r,h,o=1/0,a=1/0,d=-1/0,l=-1/0,c=!1;for(s=this.children.first;s;)s.obj.visible?(c=!0,n=s.obj.getBounds(t),o=o<n.x?o:n.x,a=a<n.y?a:n.y,r=n.width+n.x,h=n.height+n.y,d=d>r?d:r,l=l>h?l:h,s=s.next):s=s.next;if(!c)return i.EmptyRectangle;var u=this._bounds;return u.x=o,u.y=a,u.width=d-o,u.height=l-a,u},Container.prototype.getLocalBounds=function(){var t,i=this.worldTransform;for(this.worldTransform=identityMatrix,t=this.children.first;t;)t.obj.updateTransform(),t=t.next;var s=this.getBounds();return this.worldTransform=i,s},Container.prototype.setStageReference=function(t){var i;for(this.stage=t,i=this.children.first;i;)i.obj.setStageReference(t),i=i.next},Container.prototype.removeStageReference=function(){for(var t=this.children.first;t;)t.obj.removeStageReference(),t=t.next;this.stage=null},Container.prototype.draw=function(t){for(this._scratch=this.children.first;this._scratch;)this._scratch.obj.visible&&this._scratch.obj.alpha>0&&this._scratch.obj.draw(t),this._scratch=this._scratch.next},Container}({},von2d.GS,von2d.DisplayObject,von2d.LinkedList),von2d.Stage=function(t,i,s){var i=von2d.GS,s=von2d.Container,e=von2d.Matrix2,n=function(t,n,r){s.call(this),this.clearBeforeRender=!0,i.blendModesCanvas[i.blendModes.NORMAL]="source-over",i.blendModesCanvas[i.blendModes.ADD]="lighter",i.blendModesCanvas[i.blendModes.MULTIPLY]="multiply",i.blendModesCanvas[i.blendModes.SCREEN]="screen",i.blendModesCanvas[i.blendModes.OVERLAY]="overlay",i.blendModesCanvas[i.blendModes.DARKEN]="darken",i.blendModesCanvas[i.blendModes.LIGHTEN]="lighten",i.blendModesCanvas[i.blendModes.COLOR_DODGE]="color-dodge",i.blendModesCanvas[i.blendModes.COLOR_BURN]="color-burn",i.blendModesCanvas[i.blendModes.HARD_LIGHT]="hard-light",i.blendModesCanvas[i.blendModes.SOFT_LIGHT]="soft-light",i.blendModesCanvas[i.blendModes.DIFFERENCE]="difference",i.blendModesCanvas[i.blendModes.EXCLUSION]="exclusion",i.blendModesCanvas[i.blendModes.HUE]="hue",i.blendModesCanvas[i.blendModes.SATURATION]="saturation",i.blendModesCanvas[i.blendModes.COLOR]="color",i.blendModesCanvas[i.blendModes.LUMINOSITY]="luminosity",this.width=t||800,this.height=n||600,this.view=r||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.view.width=this.width,this.view.height=this.height,this.worldTransform=new e,this.stage=this,this._scratch=null};return n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.draw=function(){for(this._scratch=this.children.first,this.worldAlpha=1;this._scratch;)this._scratch.obj.updateTransform(),this._scratch=this._scratch.next;for(this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this._scratch=this.children.first;this._scratch;)this._scratch.obj.visible&&this._scratch.obj.alpha>0&&this._scratch.obj.draw(this.context),this._scratch=this._scratch.next},n.prototype.resize=function(t,i){this.width=t,this.height=i,this.view.width=t,this.view.height=i},n}({},von2d.GS,von2d.Container,von2d.Matrix2);